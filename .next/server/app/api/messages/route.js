"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/messages/route";
exports.ids = ["app/api/messages/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmessages%2Froute&page=%2Fapi%2Fmessages%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmessages%2Froute.ts&appDir=%2FUsers%2Fmichael%2FDocuments%2FKomensa-5%2Fkomensa%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmichael%2FDocuments%2FKomensa-5%2Fkomensa&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmessages%2Froute&page=%2Fapi%2Fmessages%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmessages%2Froute.ts&appDir=%2FUsers%2Fmichael%2FDocuments%2FKomensa-5%2Fkomensa%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmichael%2FDocuments%2FKomensa-5%2Fkomensa&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/.pnpm/next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/.pnpm/next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/.pnpm/next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_michael_Documents_Komensa_5_komensa_app_api_messages_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/messages/route.ts */ \"(rsc)/./app/api/messages/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/messages/route\",\n        pathname: \"/api/messages\",\n        filename: \"route\",\n        bundlePath: \"app/api/messages/route\"\n    },\n    resolvedPagePath: \"/Users/michael/Documents/Komensa-5/komensa/app/api/messages/route.ts\",\n    nextConfigOutput,\n    userland: _Users_michael_Documents_Komensa_5_komensa_app_api_messages_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/messages/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbmV4dEAxNC4yLjNfQGJhYmVsK2NvcmVANy4yNy4xX0BvcGVudGVsZW1ldHJ5K2FwaUAxLjkuMF9yZWFjdC1kb21AMTguMi4wX3JlYWN0QDE4LjIuMF9fcmVhY3RAMTguMi4wL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtYXBwLWxvYWRlci5qcz9uYW1lPWFwcCUyRmFwaSUyRm1lc3NhZ2VzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZtZXNzYWdlcyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm1lc3NhZ2VzJTJGcm91dGUudHMmYXBwRGlyPSUyRlVzZXJzJTJGbWljaGFlbCUyRkRvY3VtZW50cyUyRktvbWVuc2EtNSUyRmtvbWVuc2ElMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGbWljaGFlbCUyRkRvY3VtZW50cyUyRktvbWVuc2EtNSUyRmtvbWVuc2EmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ29CO0FBQ2pHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va29tZW5zYS12NS8/YTk5OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvbWljaGFlbC9Eb2N1bWVudHMvS29tZW5zYS01L2tvbWVuc2EvYXBwL2FwaS9tZXNzYWdlcy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvbWVzc2FnZXMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9tZXNzYWdlc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvbWVzc2FnZXMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvbWljaGFlbC9Eb2N1bWVudHMvS29tZW5zYS01L2tvbWVuc2EvYXBwL2FwaS9tZXNzYWdlcy9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvbWVzc2FnZXMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmessages%2Froute&page=%2Fapi%2Fmessages%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmessages%2Froute.ts&appDir=%2FUsers%2Fmichael%2FDocuments%2FKomensa-5%2Fkomensa%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmichael%2FDocuments%2FKomensa-5%2Fkomensa&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/[...nextauth]/route.ts":
/*!****************************************!*\
  !*** ./app/api/[...nextauth]/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/.pnpm/next-auth@4.24.11_@auth+core@0.39.1_next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_r_gev7rdmj5zqi6quqd4i72ffmfu/node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _auth_prisma_adapter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @auth/prisma-adapter */ \"(rsc)/./node_modules/.pnpm/@auth+prisma-adapter@2.9.1_@prisma+client@6.8.2_prisma@6.8.2_typescript@5.8.3__typescript@5.8.3_/node_modules/@auth/prisma-adapter/index.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next-auth/providers/google */ \"(rsc)/./node_modules/.pnpm/next-auth@4.24.11_@auth+core@0.39.1_next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_r_gev7rdmj5zqi6quqd4i72ffmfu/node_modules/next-auth/providers/google.js\");\n\n\n\n\nconst authOptions = {\n    adapter: (0,_auth_prisma_adapter__WEBPACK_IMPORTED_MODULE_1__.PrismaAdapter)(_lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma),\n    providers: [\n        (0,next_auth_providers_google__WEBPACK_IMPORTED_MODULE_3__[\"default\"])({\n            clientId: process.env.GOOGLE_CLIENT_ID,\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET\n        })\n    ],\n    session: {\n        strategy: \"jwt\"\n    },\n    pages: {\n        signIn: \"/login\"\n    }\n};\nconst { GET, POST } = next_auth__WEBPACK_IMPORTED_MODULE_0___default()(authOptions);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL1suLi5uZXh0YXV0aF0vcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBaUM7QUFDbUI7QUFDZjtBQUVtQjtBQUVqRCxNQUFNSSxjQUErQjtJQUMxQ0MsU0FBU0osbUVBQWFBLENBQUNDLCtDQUFNQTtJQUM3QkksV0FBVztRQUNUSCxzRUFBY0EsQ0FBQztZQUNiSSxVQUFVQyxRQUFRQyxHQUFHLENBQUNDLGdCQUFnQjtZQUN0Q0MsY0FBY0gsUUFBUUMsR0FBRyxDQUFDRyxvQkFBb0I7UUFDaEQ7S0FDRDtJQUNEQyxTQUFTO1FBQ1BDLFVBQVU7SUFDWjtJQUNBQyxPQUFPO1FBQ0xDLFFBQVE7SUFDVjtBQUNGLEVBQUM7QUFFTSxNQUFNLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxFQUFFLEdBQUdsQixnREFBUUEsQ0FBQ0ksYUFBYSIsInNvdXJjZXMiOlsid2VicGFjazovL2tvbWVuc2EtdjUvLi9hcHAvYXBpL1suLi5uZXh0YXV0aF0vcm91dGUudHM/YzFhYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTmV4dEF1dGggZnJvbSAnbmV4dC1hdXRoJztcbmltcG9ydCB7IFByaXNtYUFkYXB0ZXIgfSBmcm9tICdAYXV0aC9wcmlzbWEtYWRhcHRlcidcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSdcbmltcG9ydCB7IE5leHRBdXRoT3B0aW9ucyB9IGZyb20gJ25leHQtYXV0aCdcbmltcG9ydCBHb29nbGVQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2dvb2dsZSc7XG5cbmV4cG9ydCBjb25zdCBhdXRoT3B0aW9uczogTmV4dEF1dGhPcHRpb25zID0ge1xuICBhZGFwdGVyOiBQcmlzbWFBZGFwdGVyKHByaXNtYSksXG4gIHByb3ZpZGVyczogW1xuICAgIEdvb2dsZVByb3ZpZGVyKHtcbiAgICAgIGNsaWVudElkOiBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lEISxcbiAgICAgIGNsaWVudFNlY3JldDogcHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9TRUNSRVQhLFxuICAgIH0pXG4gIF0sXG4gIHNlc3Npb246IHtcbiAgICBzdHJhdGVneTogJ2p3dCdcbiAgfSxcbiAgcGFnZXM6IHtcbiAgICBzaWduSW46ICcvbG9naW4nXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IHsgR0VULCBQT1NUIH0gPSBOZXh0QXV0aChhdXRoT3B0aW9ucyk7XG4iXSwibmFtZXMiOlsiTmV4dEF1dGgiLCJQcmlzbWFBZGFwdGVyIiwicHJpc21hIiwiR29vZ2xlUHJvdmlkZXIiLCJhdXRoT3B0aW9ucyIsImFkYXB0ZXIiLCJwcm92aWRlcnMiLCJjbGllbnRJZCIsInByb2Nlc3MiLCJlbnYiLCJHT09HTEVfQ0xJRU5UX0lEIiwiY2xpZW50U2VjcmV0IiwiR09PR0xFX0NMSUVOVF9TRUNSRVQiLCJzZXNzaW9uIiwic3RyYXRlZ3kiLCJwYWdlcyIsInNpZ25JbiIsIkdFVCIsIlBPU1QiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/[...nextauth]/route.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/messages/route.ts":
/*!***********************************!*\
  !*** ./app/api/messages/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/.pnpm/next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./lib/auth.ts\");\n/* harmony import */ var _features_ai_services_generateAIReply__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/features/ai/services/generateAIReply */ \"(rsc)/./features/ai/services/generateAIReply.ts\");\n/* harmony import */ var _lib_pusher__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/pusher */ \"(rsc)/./lib/pusher.ts\");\n/* harmony import */ var _features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/features/chat/services/turnManager */ \"(rsc)/./features/chat/services/turnManager.ts\");\n// GPT CONTEXT:\n// This file handles chat message retrieval and posting, including turn-taking enforcement.\n// Related modules: /features/ai/generateAIReply.ts, /lib/prisma.ts\n// Do NOT modify /lib/redis.ts or /features/chat/events.ts in this file.\n\n\n\n\n\n\n// Helper function to get user ID from session or demo cookie\nfunction getUserId(req, session) {\n    // First try session\n    if (session?.user?.id) {\n        return session.user.id;\n    }\n    // Then try demo cookie\n    const demoUserCookie = req.cookies.get(\"demo_user\")?.value;\n    if (demoUserCookie) {\n        try {\n            const demoUser = JSON.parse(demoUserCookie);\n            return demoUser.id;\n        } catch (e) {\n            console.error(\"Failed to parse demo user cookie:\", e);\n        }\n    }\n    return null;\n}\n// GET: Fetch messages for a given chat\nasync function GET(req) {\n    const chatId = req.nextUrl.searchParams.get(\"chatId\");\n    if (!chatId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Missing chatId\"\n        }, {\n            status: 400\n        });\n    }\n    const messages = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.event.findMany({\n        where: {\n            chat_id: chatId\n        },\n        orderBy: {\n            created_at: \"asc\"\n        }\n    });\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        messages\n    });\n}\n// POST: Send a new message and update turn state\nasync function POST(req) {\n    const session = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.auth)();\n    const senderId = getUserId(req, session);\n    if (!senderId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Unauthorized\"\n        }, {\n            status: 401\n        });\n    }\n    const body = await req.json();\n    const { chatId, content } = body;\n    if (!chatId || !content) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Missing chatId or content\"\n        }, {\n            status: 400\n        });\n    }\n    console.log(\"[Messages API] Sending message:\", {\n        chatId,\n        senderId,\n        content\n    });\n    const channelName = (0,_lib_pusher__WEBPACK_IMPORTED_MODULE_4__.getChatChannelName)(chatId);\n    const turnManager = new _features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__.TurnManager(chatId);\n    // Check if this is a demo chat\n    const chat = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.chat.findUnique({\n        where: {\n            id: chatId\n        },\n        include: {\n            participants: true\n        }\n    });\n    if (chat?.origin === \"demo\") {\n        // Use role-based turn management for demo chats\n        console.log(\"[Messages API] Demo chat detected, using role-based turn management\");\n        const canSend = await turnManager.canUserSendMessage(senderId);\n        if (!canSend) {\n            const currentTurn = await turnManager.getCurrentTurn();\n            console.log(\"[Messages API] Not user turn (role-based):\", {\n                senderId,\n                currentRole: currentTurn?.next_role,\n                currentUserId: currentTurn?.next_user_id\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Not your turn\"\n            }, {\n                status: 403\n            });\n        }\n    } else {\n        // Use legacy turn management for non-demo chats\n        console.log(\"[Messages API] Non-demo chat, using legacy turn management\");\n        const turn = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.chatTurnState.findUnique({\n            where: {\n                chat_id: chatId\n            }\n        });\n        console.log(\"[Messages API] Current turn state:\", turn);\n        if (turn?.next_user_id && turn.next_user_id !== senderId) {\n            console.log(\"[Messages API] Not user turn:\", {\n                expected: turn.next_user_id,\n                actual: senderId\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Not your turn\"\n            }, {\n                status: 403\n            });\n        }\n    }\n    // Save message as event\n    const newMessage = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.event.create({\n        data: {\n            chat_id: chatId,\n            type: \"message\",\n            data: {\n                content,\n                senderId\n            },\n            created_at: new Date(),\n            seq: 0\n        }\n    });\n    console.log(\"[Messages API] Message saved to database\");\n    // Emit new message event\n    await _lib_pusher__WEBPACK_IMPORTED_MODULE_4__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_4__.PUSHER_EVENTS.NEW_MESSAGE, {\n        id: newMessage.id,\n        created_at: newMessage.created_at.toISOString(),\n        data: {\n            content,\n            senderId\n        }\n    });\n    if (chat?.origin === \"demo\") {\n        // Use role-based turn management\n        console.log(\"[Messages API] Setting turn to mediator for demo chat\");\n        await turnManager.setTurnToRole(_features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__.DEMO_ROLES.MEDIATOR);\n    } else {\n        // Use legacy turn management\n        console.log(\"[Messages API] Setting turn to assistant for non-demo chat\");\n        await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.chatTurnState.upsert({\n            where: {\n                chat_id: chatId\n            },\n            update: {\n                next_user_id: \"assistant\"\n            },\n            create: {\n                chat_id: chatId,\n                next_user_id: \"assistant\"\n            }\n        });\n        // Emit turn update\n        await _lib_pusher__WEBPACK_IMPORTED_MODULE_4__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_4__.PUSHER_EVENTS.TURN_UPDATE, {\n            next_user_id: \"assistant\"\n        });\n    }\n    // Begin AI response\n    (0,_features_ai_services_generateAIReply__WEBPACK_IMPORTED_MODULE_3__.generateAIReply)({\n        chatId,\n        userId: senderId,\n        userMessage: content\n    }).catch((err)=>{\n        console.error(\"[AI] Failed to generate reply:\", err);\n    });\n    console.log(\"[Messages API] AI reply generation started\");\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        ok: true\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL21lc3NhZ2VzL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsZUFBZTtBQUNmLDJGQUEyRjtBQUMzRixtRUFBbUU7QUFDbkUsd0VBQXdFO0FBRWhCO0FBQ2xCO0FBQ0o7QUFDdUM7QUFDTTtBQUNBO0FBRS9FLDZEQUE2RDtBQUM3RCxTQUFTUyxVQUFVQyxHQUFnQixFQUFFQyxPQUFZO0lBQy9DLG9CQUFvQjtJQUNwQixJQUFJQSxTQUFTQyxNQUFNQyxJQUFJO1FBQ3JCLE9BQU9GLFFBQVFDLElBQUksQ0FBQ0MsRUFBRTtJQUN4QjtJQUVBLHVCQUF1QjtJQUN2QixNQUFNQyxpQkFBaUJKLElBQUlLLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGNBQWNDO0lBQ3JELElBQUlILGdCQUFnQjtRQUNsQixJQUFJO1lBQ0YsTUFBTUksV0FBV0MsS0FBS0MsS0FBSyxDQUFDTjtZQUM1QixPQUFPSSxTQUFTTCxFQUFFO1FBQ3BCLEVBQUUsT0FBT1EsR0FBRztZQUNWQyxRQUFRQyxLQUFLLENBQUMscUNBQXFDRjtRQUNyRDtJQUNGO0lBRUEsT0FBTztBQUNUO0FBRUEsdUNBQXVDO0FBQ2hDLGVBQWVHLElBQUlkLEdBQWdCO0lBQ3hDLE1BQU1lLFNBQVNmLElBQUlnQixPQUFPLENBQUNDLFlBQVksQ0FBQ1gsR0FBRyxDQUFDO0lBQzVDLElBQUksQ0FBQ1MsUUFBUTtRQUNYLE9BQU96QixxREFBWUEsQ0FBQzRCLElBQUksQ0FBQztZQUFFTCxPQUFPO1FBQWlCLEdBQUc7WUFBRU0sUUFBUTtRQUFJO0lBQ3RFO0lBRUEsTUFBTUMsV0FBVyxNQUFNN0IsK0NBQU1BLENBQUM4QixLQUFLLENBQUNDLFFBQVEsQ0FBQztRQUMzQ0MsT0FBTztZQUFFQyxTQUFTVDtRQUFPO1FBQ3pCVSxTQUFTO1lBQUVDLFlBQVk7UUFBTTtJQUMvQjtJQUVBLE9BQU9wQyxxREFBWUEsQ0FBQzRCLElBQUksQ0FBQztRQUFFRTtJQUFTO0FBQ3RDO0FBRUEsaURBQWlEO0FBQzFDLGVBQWVPLEtBQUszQixHQUFnQjtJQUN6QyxNQUFNQyxVQUFVLE1BQU1ULCtDQUFJQTtJQUMxQixNQUFNb0MsV0FBVzdCLFVBQVVDLEtBQUtDO0lBRWhDLElBQUksQ0FBQzJCLFVBQVU7UUFDYixPQUFPdEMscURBQVlBLENBQUM0QixJQUFJLENBQUM7WUFBRUwsT0FBTztRQUFlLEdBQUc7WUFBRU0sUUFBUTtRQUFJO0lBQ3BFO0lBRUEsTUFBTVUsT0FBTyxNQUFNN0IsSUFBSWtCLElBQUk7SUFDM0IsTUFBTSxFQUFFSCxNQUFNLEVBQUVlLE9BQU8sRUFBRSxHQUFHRDtJQUU1QixJQUFJLENBQUNkLFVBQVUsQ0FBQ2UsU0FBUztRQUN2QixPQUFPeEMscURBQVlBLENBQUM0QixJQUFJLENBQUM7WUFBRUwsT0FBTztRQUE0QixHQUFHO1lBQUVNLFFBQVE7UUFBSTtJQUNqRjtJQUVBUCxRQUFRbUIsR0FBRyxDQUFDLG1DQUFtQztRQUFFaEI7UUFBUWE7UUFBVUU7SUFBUTtJQUUzRSxNQUFNRSxjQUFjckMsK0RBQWtCQSxDQUFDb0I7SUFDdkMsTUFBTWtCLGNBQWMsSUFBSXBDLDRFQUFXQSxDQUFDa0I7SUFFcEMsK0JBQStCO0lBQy9CLE1BQU1tQixPQUFPLE1BQU0zQywrQ0FBTUEsQ0FBQzJDLElBQUksQ0FBQ0MsVUFBVSxDQUFDO1FBQ3hDWixPQUFPO1lBQUVwQixJQUFJWTtRQUFPO1FBQ3BCcUIsU0FBUztZQUFFQyxjQUFjO1FBQUs7SUFDaEM7SUFFQSxJQUFJSCxNQUFNSSxXQUFXLFFBQVE7UUFDM0IsZ0RBQWdEO1FBQ2hEMUIsUUFBUW1CLEdBQUcsQ0FBQztRQUVaLE1BQU1RLFVBQVUsTUFBTU4sWUFBWU8sa0JBQWtCLENBQUNaO1FBQ3JELElBQUksQ0FBQ1csU0FBUztZQUNaLE1BQU1FLGNBQWMsTUFBTVIsWUFBWVMsY0FBYztZQUNwRDlCLFFBQVFtQixHQUFHLENBQUMsOENBQThDO2dCQUN4REg7Z0JBQ0FlLGFBQWFGLGFBQWFHO2dCQUMxQkMsZUFBZUosYUFBYUs7WUFDOUI7WUFDQSxPQUFPeEQscURBQVlBLENBQUM0QixJQUFJLENBQUM7Z0JBQUVMLE9BQU87WUFBZ0IsR0FBRztnQkFBRU0sUUFBUTtZQUFJO1FBQ3JFO0lBQ0YsT0FBTztRQUNMLGdEQUFnRDtRQUNoRFAsUUFBUW1CLEdBQUcsQ0FBQztRQUVaLE1BQU1nQixPQUFPLE1BQU14RCwrQ0FBTUEsQ0FBQ3lELGFBQWEsQ0FBQ2IsVUFBVSxDQUFDO1lBQUVaLE9BQU87Z0JBQUVDLFNBQVNUO1lBQU87UUFBRTtRQUNoRkgsUUFBUW1CLEdBQUcsQ0FBQyxzQ0FBc0NnQjtRQUVsRCxJQUFJQSxNQUFNRCxnQkFBZ0JDLEtBQUtELFlBQVksS0FBS2xCLFVBQVU7WUFDeERoQixRQUFRbUIsR0FBRyxDQUFDLGlDQUFpQztnQkFBRWtCLFVBQVVGLEtBQUtELFlBQVk7Z0JBQUVJLFFBQVF0QjtZQUFTO1lBQzdGLE9BQU90QyxxREFBWUEsQ0FBQzRCLElBQUksQ0FBQztnQkFBRUwsT0FBTztZQUFnQixHQUFHO2dCQUFFTSxRQUFRO1lBQUk7UUFDckU7SUFDRjtJQUVBLHdCQUF3QjtJQUN4QixNQUFNZ0MsYUFBYSxNQUFNNUQsK0NBQU1BLENBQUM4QixLQUFLLENBQUMrQixNQUFNLENBQUM7UUFDM0NDLE1BQU07WUFDSjdCLFNBQVNUO1lBQ1R1QyxNQUFNO1lBQ05ELE1BQU07Z0JBQUV2QjtnQkFBU0Y7WUFBUztZQUMxQkYsWUFBWSxJQUFJNkI7WUFDaEJDLEtBQUs7UUFDUDtJQUNGO0lBQ0E1QyxRQUFRbUIsR0FBRyxDQUFDO0lBRVoseUJBQXlCO0lBQ3pCLE1BQU1yQyxxREFBWUEsQ0FBQytELE9BQU8sQ0FBQ3pCLGFBQWFwQyxzREFBYUEsQ0FBQzhELFdBQVcsRUFBRTtRQUNqRXZELElBQUlnRCxXQUFXaEQsRUFBRTtRQUNqQnVCLFlBQVl5QixXQUFXekIsVUFBVSxDQUFDaUMsV0FBVztRQUM3Q04sTUFBTTtZQUNKdkI7WUFDQUY7UUFDRjtJQUNGO0lBRUEsSUFBSU0sTUFBTUksV0FBVyxRQUFRO1FBQzNCLGlDQUFpQztRQUNqQzFCLFFBQVFtQixHQUFHLENBQUM7UUFDWixNQUFNRSxZQUFZMkIsYUFBYSxDQUFDOUQsMkVBQVVBLENBQUMrRCxRQUFRO0lBQ3JELE9BQU87UUFDTCw2QkFBNkI7UUFDN0JqRCxRQUFRbUIsR0FBRyxDQUFDO1FBQ1osTUFBTXhDLCtDQUFNQSxDQUFDeUQsYUFBYSxDQUFDYyxNQUFNLENBQUM7WUFDaEN2QyxPQUFPO2dCQUFFQyxTQUFTVDtZQUFPO1lBQ3pCZ0QsUUFBUTtnQkFBRWpCLGNBQWM7WUFBWTtZQUNwQ00sUUFBUTtnQkFBRTVCLFNBQVNUO2dCQUFRK0IsY0FBYztZQUFZO1FBQ3ZEO1FBRUEsbUJBQW1CO1FBQ25CLE1BQU1wRCxxREFBWUEsQ0FBQytELE9BQU8sQ0FBQ3pCLGFBQWFwQyxzREFBYUEsQ0FBQ29FLFdBQVcsRUFBRTtZQUFFbEIsY0FBYztRQUFZO0lBQ2pHO0lBRUEsb0JBQW9CO0lBQ3BCckQsc0ZBQWVBLENBQUM7UUFBRXNCO1FBQVFrRCxRQUFRckM7UUFBVXNDLGFBQWFwQztJQUFRLEdBQUdxQyxLQUFLLENBQUMsQ0FBQ0M7UUFDekV4RCxRQUFRQyxLQUFLLENBQUMsa0NBQWtDdUQ7SUFDbEQ7SUFDQXhELFFBQVFtQixHQUFHLENBQUM7SUFFWixPQUFPekMscURBQVlBLENBQUM0QixJQUFJLENBQUM7UUFBRW1ELElBQUk7SUFBSztBQUN0QyIsInNvdXJjZXMiOlsid2VicGFjazovL2tvbWVuc2EtdjUvLi9hcHAvYXBpL21lc3NhZ2VzL3JvdXRlLnRzPzBmZTMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gR1BUIENPTlRFWFQ6XG4vLyBUaGlzIGZpbGUgaGFuZGxlcyBjaGF0IG1lc3NhZ2UgcmV0cmlldmFsIGFuZCBwb3N0aW5nLCBpbmNsdWRpbmcgdHVybi10YWtpbmcgZW5mb3JjZW1lbnQuXG4vLyBSZWxhdGVkIG1vZHVsZXM6IC9mZWF0dXJlcy9haS9nZW5lcmF0ZUFJUmVwbHkudHMsIC9saWIvcHJpc21hLnRzXG4vLyBEbyBOT1QgbW9kaWZ5IC9saWIvcmVkaXMudHMgb3IgL2ZlYXR1cmVzL2NoYXQvZXZlbnRzLnRzIGluIHRoaXMgZmlsZS5cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSc7XG5pbXBvcnQgeyBhdXRoIH0gZnJvbSAnQC9saWIvYXV0aCc7XG5pbXBvcnQgeyBnZW5lcmF0ZUFJUmVwbHkgfSBmcm9tICdAL2ZlYXR1cmVzL2FpL3NlcnZpY2VzL2dlbmVyYXRlQUlSZXBseSc7XG5pbXBvcnQgeyBwdXNoZXJTZXJ2ZXIsIGdldENoYXRDaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUyB9IGZyb20gJ0AvbGliL3B1c2hlcic7XG5pbXBvcnQgeyBUdXJuTWFuYWdlciwgREVNT19ST0xFUyB9IGZyb20gJ0AvZmVhdHVyZXMvY2hhdC9zZXJ2aWNlcy90dXJuTWFuYWdlcic7XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgdXNlciBJRCBmcm9tIHNlc3Npb24gb3IgZGVtbyBjb29raWVcbmZ1bmN0aW9uIGdldFVzZXJJZChyZXE6IE5leHRSZXF1ZXN0LCBzZXNzaW9uOiBhbnkpIHtcbiAgLy8gRmlyc3QgdHJ5IHNlc3Npb25cbiAgaWYgKHNlc3Npb24/LnVzZXI/LmlkKSB7XG4gICAgcmV0dXJuIHNlc3Npb24udXNlci5pZDtcbiAgfVxuICBcbiAgLy8gVGhlbiB0cnkgZGVtbyBjb29raWVcbiAgY29uc3QgZGVtb1VzZXJDb29raWUgPSByZXEuY29va2llcy5nZXQoJ2RlbW9fdXNlcicpPy52YWx1ZTtcbiAgaWYgKGRlbW9Vc2VyQ29va2llKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRlbW9Vc2VyID0gSlNPTi5wYXJzZShkZW1vVXNlckNvb2tpZSk7XG4gICAgICByZXR1cm4gZGVtb1VzZXIuaWQ7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHBhcnNlIGRlbW8gdXNlciBjb29raWU6JywgZSk7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gbnVsbDtcbn1cblxuLy8gR0VUOiBGZXRjaCBtZXNzYWdlcyBmb3IgYSBnaXZlbiBjaGF0XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgY2hhdElkID0gcmVxLm5leHRVcmwuc2VhcmNoUGFyYW1zLmdldCgnY2hhdElkJyk7XG4gIGlmICghY2hhdElkKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdNaXNzaW5nIGNoYXRJZCcgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgfVxuXG4gIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgcHJpc21hLmV2ZW50LmZpbmRNYW55KHtcbiAgICB3aGVyZTogeyBjaGF0X2lkOiBjaGF0SWQgfSxcbiAgICBvcmRlckJ5OiB7IGNyZWF0ZWRfYXQ6ICdhc2MnIH0sXG4gIH0pO1xuXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG1lc3NhZ2VzIH0pO1xufVxuXG4vLyBQT1NUOiBTZW5kIGEgbmV3IG1lc3NhZ2UgYW5kIHVwZGF0ZSB0dXJuIHN0YXRlXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XG4gIGNvbnN0IHNlbmRlcklkID0gZ2V0VXNlcklkKHJlcSwgc2Vzc2lvbik7XG4gIFxuICBpZiAoIXNlbmRlcklkKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sIHsgc3RhdHVzOiA0MDEgfSk7XG4gIH1cblxuICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgY29uc3QgeyBjaGF0SWQsIGNvbnRlbnQgfSA9IGJvZHk7XG5cbiAgaWYgKCFjaGF0SWQgfHwgIWNvbnRlbnQpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ01pc3NpbmcgY2hhdElkIG9yIGNvbnRlbnQnIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gIH1cblxuICBjb25zb2xlLmxvZygnW01lc3NhZ2VzIEFQSV0gU2VuZGluZyBtZXNzYWdlOicsIHsgY2hhdElkLCBzZW5kZXJJZCwgY29udGVudCB9KTtcblxuICBjb25zdCBjaGFubmVsTmFtZSA9IGdldENoYXRDaGFubmVsTmFtZShjaGF0SWQpO1xuICBjb25zdCB0dXJuTWFuYWdlciA9IG5ldyBUdXJuTWFuYWdlcihjaGF0SWQpO1xuXG4gIC8vIENoZWNrIGlmIHRoaXMgaXMgYSBkZW1vIGNoYXRcbiAgY29uc3QgY2hhdCA9IGF3YWl0IHByaXNtYS5jaGF0LmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7IGlkOiBjaGF0SWQgfSxcbiAgICBpbmNsdWRlOiB7IHBhcnRpY2lwYW50czogdHJ1ZSB9XG4gIH0pO1xuXG4gIGlmIChjaGF0Py5vcmlnaW4gPT09ICdkZW1vJykge1xuICAgIC8vIFVzZSByb2xlLWJhc2VkIHR1cm4gbWFuYWdlbWVudCBmb3IgZGVtbyBjaGF0c1xuICAgIGNvbnNvbGUubG9nKCdbTWVzc2FnZXMgQVBJXSBEZW1vIGNoYXQgZGV0ZWN0ZWQsIHVzaW5nIHJvbGUtYmFzZWQgdHVybiBtYW5hZ2VtZW50Jyk7XG4gICAgXG4gICAgY29uc3QgY2FuU2VuZCA9IGF3YWl0IHR1cm5NYW5hZ2VyLmNhblVzZXJTZW5kTWVzc2FnZShzZW5kZXJJZCk7XG4gICAgaWYgKCFjYW5TZW5kKSB7XG4gICAgICBjb25zdCBjdXJyZW50VHVybiA9IGF3YWl0IHR1cm5NYW5hZ2VyLmdldEN1cnJlbnRUdXJuKCk7XG4gICAgICBjb25zb2xlLmxvZygnW01lc3NhZ2VzIEFQSV0gTm90IHVzZXIgdHVybiAocm9sZS1iYXNlZCk6JywgeyBcbiAgICAgICAgc2VuZGVySWQsIFxuICAgICAgICBjdXJyZW50Um9sZTogY3VycmVudFR1cm4/Lm5leHRfcm9sZSxcbiAgICAgICAgY3VycmVudFVzZXJJZDogY3VycmVudFR1cm4/Lm5leHRfdXNlcl9pZCBcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdOb3QgeW91ciB0dXJuJyB9LCB7IHN0YXR1czogNDAzIH0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBVc2UgbGVnYWN5IHR1cm4gbWFuYWdlbWVudCBmb3Igbm9uLWRlbW8gY2hhdHNcbiAgICBjb25zb2xlLmxvZygnW01lc3NhZ2VzIEFQSV0gTm9uLWRlbW8gY2hhdCwgdXNpbmcgbGVnYWN5IHR1cm4gbWFuYWdlbWVudCcpO1xuICAgIFxuICAgIGNvbnN0IHR1cm4gPSBhd2FpdCBwcmlzbWEuY2hhdFR1cm5TdGF0ZS5maW5kVW5pcXVlKHsgd2hlcmU6IHsgY2hhdF9pZDogY2hhdElkIH0gfSk7XG4gICAgY29uc29sZS5sb2coJ1tNZXNzYWdlcyBBUEldIEN1cnJlbnQgdHVybiBzdGF0ZTonLCB0dXJuKTtcbiAgICBcbiAgICBpZiAodHVybj8ubmV4dF91c2VyX2lkICYmIHR1cm4ubmV4dF91c2VyX2lkICE9PSBzZW5kZXJJZCkge1xuICAgICAgY29uc29sZS5sb2coJ1tNZXNzYWdlcyBBUEldIE5vdCB1c2VyIHR1cm46JywgeyBleHBlY3RlZDogdHVybi5uZXh0X3VzZXJfaWQsIGFjdHVhbDogc2VuZGVySWQgfSk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ05vdCB5b3VyIHR1cm4nIH0sIHsgc3RhdHVzOiA0MDMgfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gU2F2ZSBtZXNzYWdlIGFzIGV2ZW50XG4gIGNvbnN0IG5ld01lc3NhZ2UgPSBhd2FpdCBwcmlzbWEuZXZlbnQuY3JlYXRlKHtcbiAgICBkYXRhOiB7XG4gICAgICBjaGF0X2lkOiBjaGF0SWQsXG4gICAgICB0eXBlOiAnbWVzc2FnZScsXG4gICAgICBkYXRhOiB7IGNvbnRlbnQsIHNlbmRlcklkIH0sXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgc2VxOiAwLCAvLyBwbGFjZWhvbGRlciwgY2FuIHVzZSBSZWRpcyBmb3IgYXRvbWljIHNlcSBpZiBuZWVkZWRcbiAgICB9LFxuICB9KTtcbiAgY29uc29sZS5sb2coJ1tNZXNzYWdlcyBBUEldIE1lc3NhZ2Ugc2F2ZWQgdG8gZGF0YWJhc2UnKTtcblxuICAvLyBFbWl0IG5ldyBtZXNzYWdlIGV2ZW50XG4gIGF3YWl0IHB1c2hlclNlcnZlci50cmlnZ2VyKGNoYW5uZWxOYW1lLCBQVVNIRVJfRVZFTlRTLk5FV19NRVNTQUdFLCB7XG4gICAgaWQ6IG5ld01lc3NhZ2UuaWQsXG4gICAgY3JlYXRlZF9hdDogbmV3TWVzc2FnZS5jcmVhdGVkX2F0LnRvSVNPU3RyaW5nKCksXG4gICAgZGF0YToge1xuICAgICAgY29udGVudCxcbiAgICAgIHNlbmRlcklkXG4gICAgfVxuICB9KTtcblxuICBpZiAoY2hhdD8ub3JpZ2luID09PSAnZGVtbycpIHtcbiAgICAvLyBVc2Ugcm9sZS1iYXNlZCB0dXJuIG1hbmFnZW1lbnRcbiAgICBjb25zb2xlLmxvZygnW01lc3NhZ2VzIEFQSV0gU2V0dGluZyB0dXJuIHRvIG1lZGlhdG9yIGZvciBkZW1vIGNoYXQnKTtcbiAgICBhd2FpdCB0dXJuTWFuYWdlci5zZXRUdXJuVG9Sb2xlKERFTU9fUk9MRVMuTUVESUFUT1IpO1xuICB9IGVsc2Uge1xuICAgIC8vIFVzZSBsZWdhY3kgdHVybiBtYW5hZ2VtZW50XG4gICAgY29uc29sZS5sb2coJ1tNZXNzYWdlcyBBUEldIFNldHRpbmcgdHVybiB0byBhc3Npc3RhbnQgZm9yIG5vbi1kZW1vIGNoYXQnKTtcbiAgICBhd2FpdCBwcmlzbWEuY2hhdFR1cm5TdGF0ZS51cHNlcnQoe1xuICAgICAgd2hlcmU6IHsgY2hhdF9pZDogY2hhdElkIH0sXG4gICAgICB1cGRhdGU6IHsgbmV4dF91c2VyX2lkOiAnYXNzaXN0YW50JyB9LFxuICAgICAgY3JlYXRlOiB7IGNoYXRfaWQ6IGNoYXRJZCwgbmV4dF91c2VyX2lkOiAnYXNzaXN0YW50JyB9LFxuICAgIH0pO1xuICAgIFxuICAgIC8vIEVtaXQgdHVybiB1cGRhdGVcbiAgICBhd2FpdCBwdXNoZXJTZXJ2ZXIudHJpZ2dlcihjaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUy5UVVJOX1VQREFURSwgeyBuZXh0X3VzZXJfaWQ6ICdhc3Npc3RhbnQnIH0pO1xuICB9XG5cbiAgLy8gQmVnaW4gQUkgcmVzcG9uc2VcbiAgZ2VuZXJhdGVBSVJlcGx5KHsgY2hhdElkLCB1c2VySWQ6IHNlbmRlcklkLCB1c2VyTWVzc2FnZTogY29udGVudCB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcignW0FJXSBGYWlsZWQgdG8gZ2VuZXJhdGUgcmVwbHk6JywgZXJyKTtcbiAgfSk7XG4gIGNvbnNvbGUubG9nKCdbTWVzc2FnZXMgQVBJXSBBSSByZXBseSBnZW5lcmF0aW9uIHN0YXJ0ZWQnKTtcblxuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBvazogdHJ1ZSB9KTtcbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJwcmlzbWEiLCJhdXRoIiwiZ2VuZXJhdGVBSVJlcGx5IiwicHVzaGVyU2VydmVyIiwiZ2V0Q2hhdENoYW5uZWxOYW1lIiwiUFVTSEVSX0VWRU5UUyIsIlR1cm5NYW5hZ2VyIiwiREVNT19ST0xFUyIsImdldFVzZXJJZCIsInJlcSIsInNlc3Npb24iLCJ1c2VyIiwiaWQiLCJkZW1vVXNlckNvb2tpZSIsImNvb2tpZXMiLCJnZXQiLCJ2YWx1ZSIsImRlbW9Vc2VyIiwiSlNPTiIsInBhcnNlIiwiZSIsImNvbnNvbGUiLCJlcnJvciIsIkdFVCIsImNoYXRJZCIsIm5leHRVcmwiLCJzZWFyY2hQYXJhbXMiLCJqc29uIiwic3RhdHVzIiwibWVzc2FnZXMiLCJldmVudCIsImZpbmRNYW55Iiwid2hlcmUiLCJjaGF0X2lkIiwib3JkZXJCeSIsImNyZWF0ZWRfYXQiLCJQT1NUIiwic2VuZGVySWQiLCJib2R5IiwiY29udGVudCIsImxvZyIsImNoYW5uZWxOYW1lIiwidHVybk1hbmFnZXIiLCJjaGF0IiwiZmluZFVuaXF1ZSIsImluY2x1ZGUiLCJwYXJ0aWNpcGFudHMiLCJvcmlnaW4iLCJjYW5TZW5kIiwiY2FuVXNlclNlbmRNZXNzYWdlIiwiY3VycmVudFR1cm4iLCJnZXRDdXJyZW50VHVybiIsImN1cnJlbnRSb2xlIiwibmV4dF9yb2xlIiwiY3VycmVudFVzZXJJZCIsIm5leHRfdXNlcl9pZCIsInR1cm4iLCJjaGF0VHVyblN0YXRlIiwiZXhwZWN0ZWQiLCJhY3R1YWwiLCJuZXdNZXNzYWdlIiwiY3JlYXRlIiwiZGF0YSIsInR5cGUiLCJEYXRlIiwic2VxIiwidHJpZ2dlciIsIk5FV19NRVNTQUdFIiwidG9JU09TdHJpbmciLCJzZXRUdXJuVG9Sb2xlIiwiTUVESUFUT1IiLCJ1cHNlcnQiLCJ1cGRhdGUiLCJUVVJOX1VQREFURSIsInVzZXJJZCIsInVzZXJNZXNzYWdlIiwiY2F0Y2giLCJlcnIiLCJvayJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/messages/route.ts\n");

/***/ }),

/***/ "(rsc)/./features/ai/services/formatStateForPrompt.ts":
/*!******************************************************!*\
  !*** ./features/ai/services/formatStateForPrompt.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   formatStateForPrompt: () => (/* binding */ formatStateForPrompt)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n// GPT CONTEXT:\n// This file converts chat state (feelings, needs, recent messages) into a structured prompt for the AI.\n// Related modules: /features/ai/generateAIReply.ts, /lib/prisma.ts\n// Do NOT handle AI streaming or Redis here.\n\nasync function formatStateForPrompt({ chatId, userId, userMessage }) {\n    const [participantStates, recentEvents, participants] = await Promise.all([\n        _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.event.findMany({\n            where: {\n                chat_id: chatId,\n                type: \"participant_state\"\n            },\n            orderBy: {\n                created_at: \"desc\"\n            },\n            take: 10\n        }),\n        _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.event.findMany({\n            where: {\n                chat_id: chatId\n            },\n            orderBy: {\n                created_at: \"desc\"\n            },\n            take: 10\n        }),\n        _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chatParticipant.findMany({\n            where: {\n                chat_id: chatId\n            },\n            include: {\n                user: true\n            }\n        })\n    ]);\n    const aliasMap = {};\n    for (const p of participants){\n        const initial = p.user?.display_name?.charAt(0) ?? \"U\";\n        const role = p.role ?? \"user\";\n        aliasMap[p.user_id] = `${initial}. (${role})`;\n    }\n    const views = participantStates.map((ps)=>{\n        const data = ps.data;\n        const userId = data.userId || data.user_id;\n        const alias = aliasMap[userId] || `User ${userId?.slice(0, 5) || \"Unknown\"}`;\n        return `${alias}:\n- Feels: ${(data.feelings || []).join(\", \")}\n- Needs: ${(data.needs || []).join(\", \")}\n- Views: ${Object.entries(data.viewpoints || {}).map(([k, v])=>`${k}: ${v}`).join(\"; \")}`;\n    }).join(\"\\n\\n\");\n    const recentText = recentEvents.filter((e)=>e.type === \"message\").map((e)=>{\n        const data = e.data;\n        const senderId = data.senderId;\n        const sender = aliasMap[senderId] || \"User\";\n        return `${sender}: ${data.content || \"\"}`;\n    }).reverse().join(\"\\n\");\n    const currentUserAlias = aliasMap[userId] || `User ${userId?.slice(0, 5) || \"Unknown\"}`;\n    return `<Current State>\nParticipants:\n${views}\n\nRecent Messages:\n${recentText}\n\nLatest Message:\n${currentUserAlias}: ${userMessage}\n\nInstruction:\nRespond thoughtfully as a mediator, drawing from the current emotional and conversational state.\n</Current State>`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9haS9zZXJ2aWNlcy9mb3JtYXRTdGF0ZUZvclByb21wdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLGVBQWU7QUFDZix3R0FBd0c7QUFDeEcsbUVBQW1FO0FBQ25FLDRDQUE0QztBQUVOO0FBRy9CLGVBQWVDLHFCQUFxQixFQUN6Q0MsTUFBTSxFQUNOQyxNQUFNLEVBQ05DLFdBQVcsRUFLWjtJQUNDLE1BQU0sQ0FBQ0MsbUJBQW1CQyxjQUFjQyxhQUFhLEdBQUcsTUFBTUMsUUFBUUMsR0FBRyxDQUFDO1FBQ3hFVCwrQ0FBTUEsQ0FBQ1UsS0FBSyxDQUFDQyxRQUFRLENBQUM7WUFDcEJDLE9BQU87Z0JBQ0xDLFNBQVNYO2dCQUNUWSxNQUFNO1lBQ1I7WUFDQUMsU0FBUztnQkFBRUMsWUFBWTtZQUFPO1lBQzlCQyxNQUFNO1FBQ1I7UUFDQWpCLCtDQUFNQSxDQUFDVSxLQUFLLENBQUNDLFFBQVEsQ0FBQztZQUNwQkMsT0FBTztnQkFBRUMsU0FBU1g7WUFBTztZQUN6QmEsU0FBUztnQkFBRUMsWUFBWTtZQUFPO1lBQzlCQyxNQUFNO1FBQ1I7UUFDQWpCLCtDQUFNQSxDQUFDa0IsZUFBZSxDQUFDUCxRQUFRLENBQUM7WUFDOUJDLE9BQU87Z0JBQUVDLFNBQVNYO1lBQU87WUFDekJpQixTQUFTO2dCQUFFQyxNQUFNO1lBQUs7UUFDeEI7S0FDRDtJQUVELE1BQU1DLFdBQW1DLENBQUM7SUFDMUMsS0FBSyxNQUFNQyxLQUFLZixhQUFjO1FBQzVCLE1BQU1nQixVQUFVRCxFQUFFRixJQUFJLEVBQUVJLGNBQWNDLE9BQU8sTUFBTTtRQUNuRCxNQUFNQyxPQUFPSixFQUFFSSxJQUFJLElBQUk7UUFDdkJMLFFBQVEsQ0FBQ0MsRUFBRUssT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFSixRQUFRLEdBQUcsRUFBRUcsS0FBSyxDQUFDLENBQUM7SUFDL0M7SUFFQSxNQUFNRSxRQUFRdkIsa0JBQWtCd0IsR0FBRyxDQUFDLENBQUNDO1FBQ25DLE1BQU1DLE9BQU9ELEdBQUdDLElBQUk7UUFDcEIsTUFBTTVCLFNBQVM0QixLQUFLNUIsTUFBTSxJQUFJNEIsS0FBS0osT0FBTztRQUMxQyxNQUFNSyxRQUFRWCxRQUFRLENBQUNsQixPQUFPLElBQUksQ0FBQyxLQUFLLEVBQUVBLFFBQVE4QixNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUM7UUFDNUUsT0FBTyxDQUFDLEVBQUVELE1BQU07U0FDWCxFQUFFLENBQUNELEtBQUtHLFFBQVEsSUFBSSxFQUFFLEVBQUVDLElBQUksQ0FBQyxNQUFNO1NBQ25DLEVBQUUsQ0FBQ0osS0FBS0ssS0FBSyxJQUFJLEVBQUUsRUFBRUQsSUFBSSxDQUFDLE1BQU07U0FDaEMsRUFBRSxPQUFRRyxPQUFPLENBQUNQLEtBQUtRLFVBQVUsSUFBSSxDQUFDLEdBQUdWLEdBQUcsQ0FBQyxDQUFDLENBQUNXLEdBQUdDLEVBQUUsR0FBSyxDQUFDLEVBQUVELEVBQUUsRUFBRSxFQUFFQyxFQUFFLENBQUMsRUFBR04sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUMzRixHQUFHQSxJQUFJLENBQUM7SUFFUixNQUFNTyxhQUFhcEMsYUFDaEJxQyxNQUFNLENBQUNDLENBQUFBLElBQUtBLEVBQUU5QixJQUFJLEtBQUssV0FDdkJlLEdBQUcsQ0FBQ2UsQ0FBQUE7UUFDSCxNQUFNYixPQUFPYSxFQUFFYixJQUFJO1FBQ25CLE1BQU1jLFdBQVdkLEtBQUtjLFFBQVE7UUFDOUIsTUFBTUMsU0FBU3pCLFFBQVEsQ0FBQ3dCLFNBQVMsSUFBSTtRQUNyQyxPQUFPLENBQUMsRUFBRUMsT0FBTyxFQUFFLEVBQUVmLEtBQUtnQixPQUFPLElBQUksR0FBRyxDQUFDO0lBQzNDLEdBQUdDLE9BQU8sR0FBR2IsSUFBSSxDQUFDO0lBRXBCLE1BQU1jLG1CQUFtQjVCLFFBQVEsQ0FBQ2xCLE9BQU8sSUFBSSxDQUFDLEtBQUssRUFBRUEsUUFBUThCLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQztJQUV2RixPQUFPLENBQUM7O0FBRVYsRUFBRUwsTUFBTTs7O0FBR1IsRUFBRWMsV0FBVzs7O0FBR2IsRUFBRU8saUJBQWlCLEVBQUUsRUFBRTdDLFlBQVk7Ozs7Z0JBSW5CLENBQUM7QUFDakIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9rb21lbnNhLXY1Ly4vZmVhdHVyZXMvYWkvc2VydmljZXMvZm9ybWF0U3RhdGVGb3JQcm9tcHQudHM/MmZhZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBHUFQgQ09OVEVYVDpcbi8vIFRoaXMgZmlsZSBjb252ZXJ0cyBjaGF0IHN0YXRlIChmZWVsaW5ncywgbmVlZHMsIHJlY2VudCBtZXNzYWdlcykgaW50byBhIHN0cnVjdHVyZWQgcHJvbXB0IGZvciB0aGUgQUkuXG4vLyBSZWxhdGVkIG1vZHVsZXM6IC9mZWF0dXJlcy9haS9nZW5lcmF0ZUFJUmVwbHkudHMsIC9saWIvcHJpc21hLnRzXG4vLyBEbyBOT1QgaGFuZGxlIEFJIHN0cmVhbWluZyBvciBSZWRpcyBoZXJlLlxuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnO1xuaW1wb3J0IHR5cGUgeyBFdmVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZvcm1hdFN0YXRlRm9yUHJvbXB0KHtcbiAgY2hhdElkLFxuICB1c2VySWQsXG4gIHVzZXJNZXNzYWdlXG59OiB7XG4gIGNoYXRJZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbiAgdXNlck1lc3NhZ2U6IHN0cmluZztcbn0pOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCBbcGFydGljaXBhbnRTdGF0ZXMsIHJlY2VudEV2ZW50cywgcGFydGljaXBhbnRzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICBwcmlzbWEuZXZlbnQuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgY2hhdF9pZDogY2hhdElkLFxuICAgICAgICB0eXBlOiAncGFydGljaXBhbnRfc3RhdGUnXG4gICAgICB9LFxuICAgICAgb3JkZXJCeTogeyBjcmVhdGVkX2F0OiAnZGVzYycgfSxcbiAgICAgIHRha2U6IDEwXG4gICAgfSksXG4gICAgcHJpc21hLmV2ZW50LmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7IGNoYXRfaWQ6IGNoYXRJZCB9LFxuICAgICAgb3JkZXJCeTogeyBjcmVhdGVkX2F0OiAnZGVzYycgfSxcbiAgICAgIHRha2U6IDEwXG4gICAgfSksXG4gICAgcHJpc21hLmNoYXRQYXJ0aWNpcGFudC5maW5kTWFueSh7XG4gICAgICB3aGVyZTogeyBjaGF0X2lkOiBjaGF0SWQgfSxcbiAgICAgIGluY2x1ZGU6IHsgdXNlcjogdHJ1ZSB9XG4gICAgfSlcbiAgXSk7XG5cbiAgY29uc3QgYWxpYXNNYXA6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgZm9yIChjb25zdCBwIG9mIHBhcnRpY2lwYW50cykge1xuICAgIGNvbnN0IGluaXRpYWwgPSBwLnVzZXI/LmRpc3BsYXlfbmFtZT8uY2hhckF0KDApID8/ICdVJztcbiAgICBjb25zdCByb2xlID0gcC5yb2xlID8/ICd1c2VyJztcbiAgICBhbGlhc01hcFtwLnVzZXJfaWRdID0gYCR7aW5pdGlhbH0uICgke3JvbGV9KWA7XG4gIH1cblxuICBjb25zdCB2aWV3cyA9IHBhcnRpY2lwYW50U3RhdGVzLm1hcCgocHMpID0+IHtcbiAgICBjb25zdCBkYXRhID0gcHMuZGF0YSBhcyBhbnk7XG4gICAgY29uc3QgdXNlcklkID0gZGF0YS51c2VySWQgfHwgZGF0YS51c2VyX2lkO1xuICAgIGNvbnN0IGFsaWFzID0gYWxpYXNNYXBbdXNlcklkXSB8fCBgVXNlciAke3VzZXJJZD8uc2xpY2UoMCwgNSkgfHwgJ1Vua25vd24nfWA7XG4gICAgcmV0dXJuIGAke2FsaWFzfTpcbi0gRmVlbHM6ICR7KGRhdGEuZmVlbGluZ3MgfHwgW10pLmpvaW4oJywgJyl9XG4tIE5lZWRzOiAkeyhkYXRhLm5lZWRzIHx8IFtdKS5qb2luKCcsICcpfVxuLSBWaWV3czogJHsoT2JqZWN0LmVudHJpZXMoZGF0YS52aWV3cG9pbnRzIHx8IHt9KS5tYXAoKFtrLCB2XSkgPT4gYCR7a306ICR7dn1gKSkuam9pbignOyAnKX1gO1xuICB9KS5qb2luKCdcXG5cXG4nKTtcblxuICBjb25zdCByZWNlbnRUZXh0ID0gcmVjZW50RXZlbnRzXG4gICAgLmZpbHRlcihlID0+IGUudHlwZSA9PT0gJ21lc3NhZ2UnKVxuICAgIC5tYXAoZSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gZS5kYXRhIGFzIGFueTtcbiAgICAgIGNvbnN0IHNlbmRlcklkID0gZGF0YS5zZW5kZXJJZDtcbiAgICAgIGNvbnN0IHNlbmRlciA9IGFsaWFzTWFwW3NlbmRlcklkXSB8fCAnVXNlcic7XG4gICAgICByZXR1cm4gYCR7c2VuZGVyfTogJHtkYXRhLmNvbnRlbnQgfHwgJyd9YDtcbiAgICB9KS5yZXZlcnNlKCkuam9pbignXFxuJyk7XG5cbiAgY29uc3QgY3VycmVudFVzZXJBbGlhcyA9IGFsaWFzTWFwW3VzZXJJZF0gfHwgYFVzZXIgJHt1c2VySWQ/LnNsaWNlKDAsIDUpIHx8ICdVbmtub3duJ31gO1xuXG4gIHJldHVybiBgPEN1cnJlbnQgU3RhdGU+XG5QYXJ0aWNpcGFudHM6XG4ke3ZpZXdzfVxuXG5SZWNlbnQgTWVzc2FnZXM6XG4ke3JlY2VudFRleHR9XG5cbkxhdGVzdCBNZXNzYWdlOlxuJHtjdXJyZW50VXNlckFsaWFzfTogJHt1c2VyTWVzc2FnZX1cblxuSW5zdHJ1Y3Rpb246XG5SZXNwb25kIHRob3VnaHRmdWxseSBhcyBhIG1lZGlhdG9yLCBkcmF3aW5nIGZyb20gdGhlIGN1cnJlbnQgZW1vdGlvbmFsIGFuZCBjb252ZXJzYXRpb25hbCBzdGF0ZS5cbjwvQ3VycmVudCBTdGF0ZT5gO1xufSJdLCJuYW1lcyI6WyJwcmlzbWEiLCJmb3JtYXRTdGF0ZUZvclByb21wdCIsImNoYXRJZCIsInVzZXJJZCIsInVzZXJNZXNzYWdlIiwicGFydGljaXBhbnRTdGF0ZXMiLCJyZWNlbnRFdmVudHMiLCJwYXJ0aWNpcGFudHMiLCJQcm9taXNlIiwiYWxsIiwiZXZlbnQiLCJmaW5kTWFueSIsIndoZXJlIiwiY2hhdF9pZCIsInR5cGUiLCJvcmRlckJ5IiwiY3JlYXRlZF9hdCIsInRha2UiLCJjaGF0UGFydGljaXBhbnQiLCJpbmNsdWRlIiwidXNlciIsImFsaWFzTWFwIiwicCIsImluaXRpYWwiLCJkaXNwbGF5X25hbWUiLCJjaGFyQXQiLCJyb2xlIiwidXNlcl9pZCIsInZpZXdzIiwibWFwIiwicHMiLCJkYXRhIiwiYWxpYXMiLCJzbGljZSIsImZlZWxpbmdzIiwiam9pbiIsIm5lZWRzIiwiT2JqZWN0IiwiZW50cmllcyIsInZpZXdwb2ludHMiLCJrIiwidiIsInJlY2VudFRleHQiLCJmaWx0ZXIiLCJlIiwic2VuZGVySWQiLCJzZW5kZXIiLCJjb250ZW50IiwicmV2ZXJzZSIsImN1cnJlbnRVc2VyQWxpYXMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./features/ai/services/formatStateForPrompt.ts\n");

/***/ }),

/***/ "(rsc)/./features/ai/services/generateAIReply.ts":
/*!*************************************************!*\
  !*** ./features/ai/services/generateAIReply.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateAIReply: () => (/* binding */ generateAIReply)\n/* harmony export */ });\n/* harmony import */ var _lib_openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/openai */ \"(rsc)/./lib/openai.ts\");\n/* harmony import */ var _lib_pusher__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/pusher */ \"(rsc)/./lib/pusher.ts\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _formatStateForPrompt__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./formatStateForPrompt */ \"(rsc)/./features/ai/services/formatStateForPrompt.ts\");\n/* harmony import */ var _generateJordanReply__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./generateJordanReply */ \"(rsc)/./features/ai/services/generateJordanReply.ts\");\n/* harmony import */ var _features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/features/chat/services/turnManager */ \"(rsc)/./features/chat/services/turnManager.ts\");\n// GPT CONTEXT:\n// This file triggers an OpenAI Assistant response based on a user's message.\n// It retrieves current state, formats the prompt, sends it to OpenAI, and stores the reply.\n// Related: /lib/openai.ts, /features/ai/formatStateForPrompt.ts, /lib/prisma.ts\n\n\n\n\n\n\n// Validate critical environment variables\nconst OPENAI_ASSISTANT_ID = process.env.OPENAI_ASSISTANT_ID1;\nif (!OPENAI_ASSISTANT_ID) {\n    throw new Error(\"OPENAI_ASSISTANT_ID environment variable is not set\");\n}\n// Type guard to ensure assistant_id is a string\nfunction assertAssistantId(id) {\n    if (!id) {\n        throw new Error(\"OPENAI_ASSISTANT_ID environment variable is not set\");\n    }\n}\nasync function generateAIReply({ chatId, userId, userMessage }) {\n    console.log(\"[AI Reply] Starting AI reply generation...\", {\n        chatId,\n        userId\n    });\n    const channelName = (0,_lib_pusher__WEBPACK_IMPORTED_MODULE_1__.getChatChannelName)(chatId);\n    const turnManager = new _features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__.TurnManager(chatId);\n    // Emit typing indicator\n    await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.ASSISTANT_TYPING, {\n        isTyping: true\n    });\n    // Get current state\n    console.log(\"[AI Reply] Formatting state for prompt...\");\n    const state = await (0,_formatStateForPrompt__WEBPACK_IMPORTED_MODULE_3__.formatStateForPrompt)({\n        chatId,\n        userId,\n        userMessage\n    });\n    console.log(\"[AI Reply] State formatted:\", state);\n    // Add state update instruction to the prompt\n    const fullPrompt = `${state}\n\nRespond thoughtfully as a mediator, drawing from the current emotional and conversational state.`;\n    console.log(\"[AI Reply] Full prompt prepared:\", fullPrompt);\n    // Get or create thread\n    console.log(\"[AI Reply] Getting or creating thread...\");\n    let threadId;\n    const existingThread = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.chatTurnState.findUnique({\n        where: {\n            chat_id: chatId\n        },\n        select: {\n            thread_id: true\n        }\n    });\n    if (existingThread?.thread_id) {\n        threadId = existingThread.thread_id;\n        console.log(\"[AI Reply] Using existing thread:\", threadId);\n    } else {\n        console.log(\"[AI Reply] Creating new thread...\");\n        const thread = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.create());\n        threadId = thread.id;\n        console.log(\"[AI Reply] Created new thread:\", threadId);\n        // Store thread ID for future use with proper initialization\n        await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.chatTurnState.upsert({\n            where: {\n                chat_id: chatId\n            },\n            update: {\n                thread_id: threadId\n            },\n            create: {\n                chat_id: chatId,\n                thread_id: threadId,\n                next_user_id: \"assistant\"\n            }\n        });\n        console.log(\"[AI Reply] Thread ID stored in database\");\n    }\n    // Add message to thread\n    console.log(\"[AI Reply] Adding message to thread...\");\n    await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.messages.create(threadId, {\n            role: \"user\",\n            content: fullPrompt\n        }));\n    console.log(\"[AI Reply] Message added to thread\");\n    // Start run (non-streaming for simplicity and speed)\n    let fullMessage = \"\";\n    try {\n        console.log(\"[AI Reply] Starting AI run...\");\n        assertAssistantId(OPENAI_ASSISTANT_ID);\n        const run = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.runs.create(threadId, {\n                assistant_id: OPENAI_ASSISTANT_ID\n            }));\n        console.log(\"[AI Reply] Run created:\", run.id);\n        let completedRun = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.runs.retrieve(threadId, run.id));\n        console.log(\"[AI Reply] Initial run status:\", completedRun.status);\n        while(completedRun.status === \"in_progress\" || completedRun.status === \"queued\"){\n            await new Promise((resolve)=>setTimeout(resolve, 1000));\n            try {\n                completedRun = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.runs.retrieve(threadId, run.id));\n                console.log(\"[AI Reply] Run status:\", completedRun.status);\n            } catch (error) {\n                console.error(\"[AI Reply] Run retrieval failed:\", error);\n                throw new Error(\"Failed to get AI response during polling\", {\n                    cause: error\n                });\n            }\n        }\n        if (completedRun.status === \"failed\") {\n            console.error(\"[AI Reply] Run failed:\", completedRun.last_error);\n            throw new Error(`AI run failed: ${completedRun.last_error?.message}`);\n        }\n        // Get messages\n        console.log(\"[AI Reply] Retrieving messages...\");\n        const messages = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.messages.list(threadId));\n        const assistantMessage = messages.data[0];\n        if (!assistantMessage || !assistantMessage.content) {\n            console.error(\"[AI Reply] No assistant message found\");\n            throw new Error(\"No assistant message returned\");\n        }\n        fullMessage = assistantMessage.content.filter((c)=>c.type === \"text\").map((c)=>c.text.value).join(\"\");\n        console.log(\"[AI Reply] Message retrieved:\", fullMessage);\n    } catch (error) {\n        console.error(\"[AI Reply] Failed to generate AI response:\", error);\n        // Stop typing indicator on error\n        await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.ASSISTANT_TYPING, {\n            isTyping: false\n        });\n        throw error;\n    }\n    // Stop typing indicator\n    await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.ASSISTANT_TYPING, {\n        isTyping: false\n    });\n    // Process the message (no longer need to parse STATE_UPDATE_JSON)\n    console.log(\"[AI Reply] Processing message...\");\n    const cleanedMessage = fullMessage.trim();\n    // Store message in database\n    console.log(\"[AI Reply] Storing message in database...\");\n    const newMessage = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.event.create({\n        data: {\n            chat_id: chatId,\n            type: \"message\",\n            data: {\n                content: cleanedMessage,\n                senderId: \"assistant\"\n            }\n        }\n    });\n    // Emit new message event\n    await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.NEW_MESSAGE, {\n        id: newMessage.id,\n        created_at: newMessage.created_at.toISOString(),\n        data: {\n            content: cleanedMessage,\n            senderId: \"assistant\"\n        }\n    });\n    // Check if this is a demo chat and handle the conversation flow\n    const chat = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.chat.findUnique({\n        where: {\n            id: chatId\n        },\n        include: {\n            participants: true\n        }\n    });\n    if (chat?.origin === \"demo\") {\n        console.log(\"[AI Reply] Demo chat detected, using role-based turn management...\");\n        // Get the role of the user who sent the message that triggered this mediator response\n        const userRole = await turnManager.getRoleForUserId(userId);\n        console.log(\"[AI Reply] User role who triggered mediator:\", userRole);\n        if (userRole === _features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__.DEMO_ROLES.USER_A) {\n            // Mediator just responded to User A → next turn should be Jordan\n            console.log(\"[AI Reply] Mediator responded to User A, setting turn to Jordan...\");\n            await turnManager.setTurnToRole(_features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__.DEMO_ROLES.JORDAN);\n            // Trigger Jordan's response automatically\n            const jordanUserId = await turnManager.getUserIdForRole(_features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__.DEMO_ROLES.JORDAN);\n            if (jordanUserId) {\n                (0,_generateJordanReply__WEBPACK_IMPORTED_MODULE_4__.generateJordanReply)({\n                    chatId,\n                    jordanUserId,\n                    conversationContext: cleanedMessage\n                }).catch((error)=>{\n                    console.error(\"[AI Reply] Failed to generate Jordan response:\", error);\n                });\n            }\n        } else if (userRole === _features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__.DEMO_ROLES.JORDAN) {\n            // Mediator just responded to Jordan → next turn should be User A\n            console.log(\"[AI Reply] Mediator responded to Jordan, setting turn to User A...\");\n            await turnManager.setTurnToRole(_features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_5__.DEMO_ROLES.USER_A);\n        } else {\n            // Fallback: advance to next turn in sequence\n            console.log(\"[AI Reply] Unknown user role, advancing turn normally...\");\n            await turnManager.advanceTurn();\n        }\n    } else {\n        // For non-demo chats, use the old logic\n        console.log(\"[AI Reply] Non-demo chat, using legacy turn management...\");\n        await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.chatTurnState.update({\n            where: {\n                chat_id: chatId\n            },\n            data: {\n                next_user_id: userId\n            }\n        });\n        // Emit turn update\n        await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.TURN_UPDATE, {\n            next_user_id: userId\n        });\n    }\n    console.log(\"[AI Reply] Generation complete\");\n    return {\n        content: cleanedMessage\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9haS9zZXJ2aWNlcy9nZW5lcmF0ZUFJUmVwbHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLGVBQWU7QUFDZiw2RUFBNkU7QUFDN0UsNEZBQTRGO0FBQzVGLGdGQUFnRjtBQUUxQjtBQUN5QjtBQUN6QztBQUN3QjtBQUVGO0FBQ21CO0FBRy9FLDBDQUEwQztBQUMxQyxNQUFNVSxzQkFBc0JDLFFBQVFDLEdBQUcsQ0FBQ0Msb0JBQW9CO0FBQzVELElBQUksQ0FBQ0gscUJBQXFCO0lBQ3hCLE1BQU0sSUFBSUksTUFBTTtBQUNsQjtBQUVBLGdEQUFnRDtBQUNoRCxTQUFTQyxrQkFBa0JDLEVBQXNCO0lBQy9DLElBQUksQ0FBQ0EsSUFBSTtRQUNQLE1BQU0sSUFBSUYsTUFBTTtJQUNsQjtBQUNGO0FBRU8sZUFBZUcsZ0JBQWdCLEVBQ3BDQyxNQUFNLEVBQ05DLE1BQU0sRUFDTkMsV0FBVyxFQUtaO0lBQ0NDLFFBQVFDLEdBQUcsQ0FBQyw4Q0FBOEM7UUFBRUo7UUFBUUM7SUFBTztJQUUzRSxNQUFNSSxjQUFjcEIsK0RBQWtCQSxDQUFDZTtJQUN2QyxNQUFNTSxjQUFjLElBQUloQiw0RUFBV0EsQ0FBQ1U7SUFFcEMsd0JBQXdCO0lBQ3hCLE1BQU1oQixxREFBWUEsQ0FBQ3VCLE9BQU8sQ0FBQ0YsYUFBYW5CLHNEQUFhQSxDQUFDc0IsZ0JBQWdCLEVBQUU7UUFBRUMsVUFBVTtJQUFLO0lBRXpGLG9CQUFvQjtJQUNwQk4sUUFBUUMsR0FBRyxDQUFDO0lBQ1osTUFBTU0sUUFBUSxNQUFNdEIsMkVBQW9CQSxDQUFDO1FBQUVZO1FBQVFDO1FBQVFDO0lBQVk7SUFDdkVDLFFBQVFDLEdBQUcsQ0FBQywrQkFBK0JNO0lBRTNDLDZDQUE2QztJQUM3QyxNQUFNQyxhQUFhLENBQUMsRUFBRUQsTUFBTTs7Z0dBRWtFLENBQUM7SUFDL0ZQLFFBQVFDLEdBQUcsQ0FBQyxvQ0FBb0NPO0lBRWhELHVCQUF1QjtJQUN2QlIsUUFBUUMsR0FBRyxDQUFD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ekMsaUVBQWlFO1lBQ2pFbkUsUUFBUUMsR0FBRyxDQUFDO1lBQ1osTUFBTUUsWUFBWStELGFBQWEsQ0FBQzlFLDJFQUFVQSxDQUFDNkUsTUFBTTtRQUNuRCxPQUFPO1lBQ0wsNkNBQTZDO1lBQzdDakUsUUFBUUMsR0FBRyxDQUFDO1lBQ1osTUFBTUUsWUFBWXFFLFdBQVc7UUFDL0I7SUFDRixPQUFPO1FBQ0wsd0NBQXdDO1FBQ3hDeEUsUUFBUUMsR0FBRyxDQUFDO1FBQ1osTUFBTWpCLCtDQUFNQSxDQUFDMkIsYUFBYSxDQUFDVyxNQUFNLENBQUM7WUFDaENULE9BQU87Z0JBQUVDLFNBQVNqQjtZQUFPO1lBQ3pCOEMsTUFBTTtnQkFBRXBCLGNBQWN6QjtZQUFPO1FBQy9CO1FBRUEsbUJBQW1CO1FBQ25CLE1BQU1qQixxREFBWUEsQ0FBQ3VCLE9BQU8sQ0FBQ0YsYUFBYW5CLHNEQUFhQSxDQUFDMEYsV0FBVyxFQUFFO1lBQUVsRCxjQUFjekI7UUFBTztJQUM1RjtJQUVBRSxRQUFRQyxHQUFHLENBQUM7SUFDWixPQUFPO1FBQUV5QixTQUFTeUI7SUFBZTtBQUNuQyIsInNvdXJjZXMiOlsid2VicGFjazovL2tvbWVuc2EtdjUvLi9mZWF0dXJlcy9haS9zZXJ2aWNlcy9nZW5lcmF0ZUFJUmVwbHkudHM/YjlmNSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBHUFQgQ09OVEVYVDpcbi8vIFRoaXMgZmlsZSB0cmlnZ2VycyBhbiBPcGVuQUkgQXNzaXN0YW50IHJlc3BvbnNlIGJhc2VkIG9uIGEgdXNlcidzIG1lc3NhZ2UuXG4vLyBJdCByZXRyaWV2ZXMgY3VycmVudCBzdGF0ZSwgZm9ybWF0cyB0aGUgcHJvbXB0LCBzZW5kcyBpdCB0byBPcGVuQUksIGFuZCBzdG9yZXMgdGhlIHJlcGx5LlxuLy8gUmVsYXRlZDogL2xpYi9vcGVuYWkudHMsIC9mZWF0dXJlcy9haS9mb3JtYXRTdGF0ZUZvclByb21wdC50cywgL2xpYi9wcmlzbWEudHNcblxuaW1wb3J0IHsgb3BlbmFpLCBydW5XaXRoUmV0cmllcyB9IGZyb20gJ0AvbGliL29wZW5haSc7XG5pbXBvcnQgeyBwdXNoZXJTZXJ2ZXIsIGdldENoYXRDaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUyB9IGZyb20gJ0AvbGliL3B1c2hlcic7XG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnO1xuaW1wb3J0IHsgZm9ybWF0U3RhdGVGb3JQcm9tcHQgfSBmcm9tICcuL2Zvcm1hdFN0YXRlRm9yUHJvbXB0JztcbmltcG9ydCB7IHBhcnNlU3RhdGVVcGRhdGUsIHBhcnNlU3RhdGVVcGRhdGVBbmRDbGVhbk1lc3NhZ2UgfSBmcm9tICcuL3BhcnNlU3RhdGVVcGRhdGUnO1xuaW1wb3J0IHsgZ2VuZXJhdGVKb3JkYW5SZXBseSB9IGZyb20gJy4vZ2VuZXJhdGVKb3JkYW5SZXBseSc7XG5pbXBvcnQgeyBUdXJuTWFuYWdlciwgREVNT19ST0xFUyB9IGZyb20gJ0AvZmVhdHVyZXMvY2hhdC9zZXJ2aWNlcy90dXJuTWFuYWdlcic7XG5pbXBvcnQgdHlwZSB7IFJ1biB9IGZyb20gJ29wZW5haS9yZXNvdXJjZXMvYmV0YS90aHJlYWRzL3J1bnMvcnVucyc7XG5cbi8vIFZhbGlkYXRlIGNyaXRpY2FsIGVudmlyb25tZW50IHZhcmlhYmxlc1xuY29uc3QgT1BFTkFJX0FTU0lTVEFOVF9JRCA9IHByb2Nlc3MuZW52Lk9QRU5BSV9BU1NJU1RBTlRfSUQxO1xuaWYgKCFPUEVOQUlfQVNTSVNUQU5UX0lEKSB7XG4gIHRocm93IG5ldyBFcnJvcignT1BFTkFJX0FTU0lTVEFOVF9JRCBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0Jyk7XG59XG5cbi8vIFR5cGUgZ3VhcmQgdG8gZW5zdXJlIGFzc2lzdGFudF9pZCBpcyBhIHN0cmluZ1xuZnVuY3Rpb24gYXNzZXJ0QXNzaXN0YW50SWQoaWQ6IHN0cmluZyB8IHVuZGVmaW5lZCk6IGFzc2VydHMgaWQgaXMgc3RyaW5nIHtcbiAgaWYgKCFpZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignT1BFTkFJX0FTU0lTVEFOVF9JRCBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0Jyk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQUlSZXBseSh7XG4gIGNoYXRJZCxcbiAgdXNlcklkLFxuICB1c2VyTWVzc2FnZVxufToge1xuICBjaGF0SWQ6IHN0cmluZztcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHVzZXJNZXNzYWdlOiBzdHJpbmc7XG59KSB7XG4gIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIFN0YXJ0aW5nIEFJIHJlcGx5IGdlbmVyYXRpb24uLi4nLCB7IGNoYXRJZCwgdXNlcklkIH0pO1xuICBcbiAgY29uc3QgY2hhbm5lbE5hbWUgPSBnZXRDaGF0Q2hhbm5lbE5hbWUoY2hhdElkKTtcbiAgY29uc3QgdHVybk1hbmFnZXIgPSBuZXcgVHVybk1hbmFnZXIoY2hhdElkKTtcbiAgXG4gIC8vIEVtaXQgdHlwaW5nIGluZGljYXRvclxuICBhd2FpdCBwdXNoZXJTZXJ2ZXIudHJpZ2dlcihjaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUy5BU1NJU1RBTlRfVFlQSU5HLCB7IGlzVHlwaW5nOiB0cnVlIH0pO1xuICBcbiAgLy8gR2V0IGN1cnJlbnQgc3RhdGVcbiAgY29uc29sZS5sb2coJ1tBSSBSZXBseV0gRm9ybWF0dGluZyBzdGF0ZSBmb3IgcHJvbXB0Li4uJyk7XG4gIGNvbnN0IHN0YXRlID0gYXdhaXQgZm9ybWF0U3RhdGVGb3JQcm9tcHQoeyBjaGF0SWQsIHVzZXJJZCwgdXNlck1lc3NhZ2UgfSk7XG4gIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIFN0YXRlIGZvcm1hdHRlZDonLCBzdGF0ZSk7XG5cbiAgLy8gQWRkIHN0YXRlIHVwZGF0ZSBpbnN0cnVjdGlvbiB0byB0aGUgcHJvbXB0XG4gIGNvbnN0IGZ1bGxQcm9tcHQgPSBgJHtzdGF0ZX1cblxuUmVzcG9uZCB0aG91Z2h0ZnVsbHkgYXMgYSBtZWRpYXRvciwgZHJhd2luZyBmcm9tIHRoZSBjdXJyZW50IGVtb3Rpb25hbCBhbmQgY29udmVyc2F0aW9uYWwgc3RhdGUuYDtcbiAgY29uc29sZS5sb2coJ1tBSSBSZXBseV0gRnVsbCBwcm9tcHQgcHJlcGFyZWQ6JywgZnVsbFByb21wdCk7XG5cbiAgLy8gR2V0IG9yIGNyZWF0ZSB0aHJlYWRcbiAgY29uc29sZS5sb2coJ1tBSSBSZXBseV0gR2V0dGluZyBvciBjcmVhdGluZyB0aHJlYWQuLi4nKTtcbiAgbGV0IHRocmVhZElkOiBzdHJpbmc7XG4gIGNvbnN0IGV4aXN0aW5nVGhyZWFkID0gYXdhaXQgcHJpc21hLmNoYXRUdXJuU3RhdGUuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgY2hhdF9pZDogY2hhdElkIH0sXG4gICAgc2VsZWN0OiB7IHRocmVhZF9pZDogdHJ1ZSB9XG4gIH0pO1xuXG4gIGlmIChleGlzdGluZ1RocmVhZD8udGhyZWFkX2lkKSB7XG4gICAgdGhyZWFkSWQgPSBleGlzdGluZ1RocmVhZC50aHJlYWRfaWQ7XG4gICAgY29uc29sZS5sb2coJ1tBSSBSZXBseV0gVXNpbmcgZXhpc3RpbmcgdGhyZWFkOicsIHRocmVhZElkKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBDcmVhdGluZyBuZXcgdGhyZWFkLi4uJyk7XG4gICAgY29uc3QgdGhyZWFkID0gYXdhaXQgcnVuV2l0aFJldHJpZXMoKCkgPT4gXG4gICAgICBvcGVuYWkuYmV0YS50aHJlYWRzLmNyZWF0ZSgpXG4gICAgKTtcbiAgICB0aHJlYWRJZCA9IHRocmVhZC5pZDtcbiAgICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBDcmVhdGVkIG5ldyB0aHJlYWQ6JywgdGhyZWFkSWQpO1xuICAgIFxuICAgIC8vIFN0b3JlIHRocmVhZCBJRCBmb3IgZnV0dXJlIHVzZSB3aXRoIHByb3BlciBpbml0aWFsaXphdGlvblxuICAgIGF3YWl0IHByaXNtYS5jaGF0VHVyblN0YXRlLnVwc2VydCh7XG4gICAgICB3aGVyZTogeyBjaGF0X2lkOiBjaGF0SWQgfSxcbiAgICAgIHVwZGF0ZTogeyB0aHJlYWRfaWQ6IHRocmVhZElkIH0sXG4gICAgICBjcmVhdGU6IHsgXG4gICAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgICAgdGhyZWFkX2lkOiB0aHJlYWRJZCxcbiAgICAgICAgbmV4dF91c2VyX2lkOiAnYXNzaXN0YW50J1xuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIFRocmVhZCBJRCBzdG9yZWQgaW4gZGF0YWJhc2UnKTtcbiAgfVxuXG4gIC8vIEFkZCBtZXNzYWdlIHRvIHRocmVhZFxuICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBBZGRpbmcgbWVzc2FnZSB0byB0aHJlYWQuLi4nKTtcbiAgYXdhaXQgcnVuV2l0aFJldHJpZXMoKCkgPT5cbiAgICBvcGVuYWkuYmV0YS50aHJlYWRzLm1lc3NhZ2VzLmNyZWF0ZSh0aHJlYWRJZCwge1xuICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgY29udGVudDogZnVsbFByb21wdFxuICAgIH0pXG4gICk7XG4gIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIE1lc3NhZ2UgYWRkZWQgdG8gdGhyZWFkJyk7XG5cbiAgLy8gU3RhcnQgcnVuIChub24tc3RyZWFtaW5nIGZvciBzaW1wbGljaXR5IGFuZCBzcGVlZClcbiAgbGV0IGZ1bGxNZXNzYWdlID0gJyc7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1tBSSBSZXBseV0gU3RhcnRpbmcgQUkgcnVuLi4uJyk7XG4gICAgYXNzZXJ0QXNzaXN0YW50SWQoT1BFTkFJX0FTU0lTVEFOVF9JRCk7XG4gICAgY29uc3QgcnVuID0gYXdhaXQgcnVuV2l0aFJldHJpZXMoKCkgPT5cbiAgICAgIG9wZW5haS5iZXRhLnRocmVhZHMucnVucy5jcmVhdGUodGhyZWFkSWQsIHtcbiAgICAgICAgYXNzaXN0YW50X2lkOiBPUEVOQUlfQVNTSVNUQU5UX0lEXG4gICAgICB9KVxuICAgICkgYXMgUnVuO1xuICAgIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIFJ1biBjcmVhdGVkOicsIHJ1bi5pZCk7XG4gICAgXG4gICAgbGV0IGNvbXBsZXRlZFJ1biA9IGF3YWl0IHJ1bldpdGhSZXRyaWVzKCgpID0+XG4gICAgICBvcGVuYWkuYmV0YS50aHJlYWRzLnJ1bnMucmV0cmlldmUodGhyZWFkSWQsIHJ1bi5pZClcbiAgICApO1xuICAgIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIEluaXRpYWwgcnVuIHN0YXR1czonLCBjb21wbGV0ZWRSdW4uc3RhdHVzKTtcbiAgICBcbiAgICB3aGlsZSAoY29tcGxldGVkUnVuLnN0YXR1cyA9PT0gJ2luX3Byb2dyZXNzJyB8fCBjb21wbGV0ZWRSdW4uc3RhdHVzID09PSAncXVldWVkJykge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbXBsZXRlZFJ1biA9IGF3YWl0IHJ1bldpdGhSZXRyaWVzKCgpID0+XG4gICAgICAgICAgb3BlbmFpLmJldGEudGhyZWFkcy5ydW5zLnJldHJpZXZlKHRocmVhZElkLCBydW4uaWQpXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIFJ1biBzdGF0dXM6JywgY29tcGxldGVkUnVuLnN0YXR1cyk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbQUkgUmVwbHldIFJ1biByZXRyaWV2YWwgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZ2V0IEFJIHJlc3BvbnNlIGR1cmluZyBwb2xsaW5nJywgeyBjYXVzZTogZXJyb3IgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGlmIChjb21wbGV0ZWRSdW4uc3RhdHVzID09PSAnZmFpbGVkJykge1xuICAgICAgY29uc29sZS5lcnJvcignW0FJIFJlcGx5XSBSdW4gZmFpbGVkOicsIGNvbXBsZXRlZFJ1bi5sYXN0X2Vycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQUkgcnVuIGZhaWxlZDogJHtjb21wbGV0ZWRSdW4ubGFzdF9lcnJvcj8ubWVzc2FnZX1gKTtcbiAgICB9XG4gICAgXG4gICAgLy8gR2V0IG1lc3NhZ2VzXG4gICAgY29uc29sZS5sb2coJ1tBSSBSZXBseV0gUmV0cmlldmluZyBtZXNzYWdlcy4uLicpO1xuICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgcnVuV2l0aFJldHJpZXMoKCkgPT5cbiAgICAgIG9wZW5haS5iZXRhLnRocmVhZHMubWVzc2FnZXMubGlzdCh0aHJlYWRJZClcbiAgICApO1xuICAgIGNvbnN0IGFzc2lzdGFudE1lc3NhZ2UgPSBtZXNzYWdlcy5kYXRhWzBdO1xuICAgIGlmICghYXNzaXN0YW50TWVzc2FnZSB8fCAhYXNzaXN0YW50TWVzc2FnZS5jb250ZW50KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbQUkgUmVwbHldIE5vIGFzc2lzdGFudCBtZXNzYWdlIGZvdW5kJyk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGFzc2lzdGFudCBtZXNzYWdlIHJldHVybmVkJyk7XG4gICAgfVxuICAgIFxuICAgIGZ1bGxNZXNzYWdlID0gYXNzaXN0YW50TWVzc2FnZS5jb250ZW50XG4gICAgICAuZmlsdGVyKChjOiBhbnkpOiBjIGlzIHsgdHlwZTogJ3RleHQnOyB0ZXh0OiB7IHZhbHVlOiBzdHJpbmc7IGFubm90YXRpb25zOiBhbnlbXSB9IH0gPT4gYy50eXBlID09PSAndGV4dCcpXG4gICAgICAubWFwKChjOiBhbnkpID0+IGMudGV4dC52YWx1ZSlcbiAgICAgIC5qb2luKCcnKTtcbiAgICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBNZXNzYWdlIHJldHJpZXZlZDonLCBmdWxsTWVzc2FnZSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW0FJIFJlcGx5XSBGYWlsZWQgdG8gZ2VuZXJhdGUgQUkgcmVzcG9uc2U6JywgZXJyb3IpO1xuICAgIC8vIFN0b3AgdHlwaW5nIGluZGljYXRvciBvbiBlcnJvclxuICAgIGF3YWl0IHB1c2hlclNlcnZlci50cmlnZ2VyKGNoYW5uZWxOYW1lLCBQVVNIRVJfRVZFTlRTLkFTU0lTVEFOVF9UWVBJTkcsIHsgaXNUeXBpbmc6IGZhbHNlIH0pO1xuICAgIHRocm93IGVycm9yO1xuICB9XG5cbiAgLy8gU3RvcCB0eXBpbmcgaW5kaWNhdG9yXG4gIGF3YWl0IHB1c2hlclNlcnZlci50cmlnZ2VyKGNoYW5uZWxOYW1lLCBQVVNIRVJfRVZFTlRTLkFTU0lTVEFOVF9UWVBJTkcsIHsgaXNUeXBpbmc6IGZhbHNlIH0pO1xuXG4gIC8vIFByb2Nlc3MgdGhlIG1lc3NhZ2UgKG5vIGxvbmdlciBuZWVkIHRvIHBhcnNlIFNUQVRFX1VQREFURV9KU09OKVxuICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBQcm9jZXNzaW5nIG1lc3NhZ2UuLi4nKTtcbiAgY29uc3QgY2xlYW5lZE1lc3NhZ2UgPSBmdWxsTWVzc2FnZS50cmltKCk7XG5cbiAgLy8gU3RvcmUgbWVzc2FnZSBpbiBkYXRhYmFzZVxuICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBTdG9yaW5nIG1lc3NhZ2UgaW4gZGF0YWJhc2UuLi4nKTtcbiAgY29uc3QgbmV3TWVzc2FnZSA9IGF3YWl0IHByaXNtYS5ldmVudC5jcmVhdGUoe1xuICAgIGRhdGE6IHtcbiAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgIHR5cGU6ICdtZXNzYWdlJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY29udGVudDogY2xlYW5lZE1lc3NhZ2UsXG4gICAgICAgIHNlbmRlcklkOiAnYXNzaXN0YW50J1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgLy8gRW1pdCBuZXcgbWVzc2FnZSBldmVudFxuICBhd2FpdCBwdXNoZXJTZXJ2ZXIudHJpZ2dlcihjaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUy5ORVdfTUVTU0FHRSwge1xuICAgIGlkOiBuZXdNZXNzYWdlLmlkLFxuICAgIGNyZWF0ZWRfYXQ6IG5ld01lc3NhZ2UuY3JlYXRlZF9hdC50b0lTT1N0cmluZygpLFxuICAgIGRhdGE6IHtcbiAgICAgIGNvbnRlbnQ6IGNsZWFuZWRNZXNzYWdlLFxuICAgICAgc2VuZGVySWQ6ICdhc3Npc3RhbnQnXG4gICAgfVxuICB9KTtcblxuICAvLyBDaGVjayBpZiB0aGlzIGlzIGEgZGVtbyBjaGF0IGFuZCBoYW5kbGUgdGhlIGNvbnZlcnNhdGlvbiBmbG93XG4gIGNvbnN0IGNoYXQgPSBhd2FpdCBwcmlzbWEuY2hhdC5maW5kVW5pcXVlKHtcbiAgICB3aGVyZTogeyBpZDogY2hhdElkIH0sXG4gICAgaW5jbHVkZTogeyBwYXJ0aWNpcGFudHM6IHRydWUgfVxuICB9KTtcblxuICBpZiAoY2hhdD8ub3JpZ2luID09PSAnZGVtbycpIHtcbiAgICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBEZW1vIGNoYXQgZGV0ZWN0ZWQsIHVzaW5nIHJvbGUtYmFzZWQgdHVybiBtYW5hZ2VtZW50Li4uJyk7XG4gICAgXG4gICAgLy8gR2V0IHRoZSByb2xlIG9mIHRoZSB1c2VyIHdobyBzZW50IHRoZSBtZXNzYWdlIHRoYXQgdHJpZ2dlcmVkIHRoaXMgbWVkaWF0b3IgcmVzcG9uc2VcbiAgICBjb25zdCB1c2VyUm9sZSA9IGF3YWl0IHR1cm5NYW5hZ2VyLmdldFJvbGVGb3JVc2VySWQodXNlcklkKTtcbiAgICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBVc2VyIHJvbGUgd2hvIHRyaWdnZXJlZCBtZWRpYXRvcjonLCB1c2VyUm9sZSk7XG5cbiAgICBpZiAodXNlclJvbGUgPT09IERFTU9fUk9MRVMuVVNFUl9BKSB7XG4gICAgICAvLyBNZWRpYXRvciBqdXN0IHJlc3BvbmRlZCB0byBVc2VyIEEg4oaSIG5leHQgdHVybiBzaG91bGQgYmUgSm9yZGFuXG4gICAgICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBNZWRpYXRvciByZXNwb25kZWQgdG8gVXNlciBBLCBzZXR0aW5nIHR1cm4gdG8gSm9yZGFuLi4uJyk7XG4gICAgICBhd2FpdCB0dXJuTWFuYWdlci5zZXRUdXJuVG9Sb2xlKERFTU9fUk9MRVMuSk9SREFOKTtcbiAgICAgIFxuICAgICAgLy8gVHJpZ2dlciBKb3JkYW4ncyByZXNwb25zZSBhdXRvbWF0aWNhbGx5XG4gICAgICBjb25zdCBqb3JkYW5Vc2VySWQgPSBhd2FpdCB0dXJuTWFuYWdlci5nZXRVc2VySWRGb3JSb2xlKERFTU9fUk9MRVMuSk9SREFOKTtcbiAgICAgIGlmIChqb3JkYW5Vc2VySWQpIHtcbiAgICAgICAgZ2VuZXJhdGVKb3JkYW5SZXBseSh7XG4gICAgICAgICAgY2hhdElkLFxuICAgICAgICAgIGpvcmRhblVzZXJJZCxcbiAgICAgICAgICBjb252ZXJzYXRpb25Db250ZXh0OiBjbGVhbmVkTWVzc2FnZVxuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignW0FJIFJlcGx5XSBGYWlsZWQgdG8gZ2VuZXJhdGUgSm9yZGFuIHJlc3BvbnNlOicsIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh1c2VyUm9sZSA9PT0gREVNT19ST0xFUy5KT1JEQU4pIHtcbiAgICAgIC8vIE1lZGlhdG9yIGp1c3QgcmVzcG9uZGVkIHRvIEpvcmRhbiDihpIgbmV4dCB0dXJuIHNob3VsZCBiZSBVc2VyIEFcbiAgICAgIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIE1lZGlhdG9yIHJlc3BvbmRlZCB0byBKb3JkYW4sIHNldHRpbmcgdHVybiB0byBVc2VyIEEuLi4nKTtcbiAgICAgIGF3YWl0IHR1cm5NYW5hZ2VyLnNldFR1cm5Ub1JvbGUoREVNT19ST0xFUy5VU0VSX0EpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGYWxsYmFjazogYWR2YW5jZSB0byBuZXh0IHR1cm4gaW4gc2VxdWVuY2VcbiAgICAgIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIFVua25vd24gdXNlciByb2xlLCBhZHZhbmNpbmcgdHVybiBub3JtYWxseS4uLicpO1xuICAgICAgYXdhaXQgdHVybk1hbmFnZXIuYWR2YW5jZVR1cm4oKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gRm9yIG5vbi1kZW1vIGNoYXRzLCB1c2UgdGhlIG9sZCBsb2dpY1xuICAgIGNvbnNvbGUubG9nKCdbQUkgUmVwbHldIE5vbi1kZW1vIGNoYXQsIHVzaW5nIGxlZ2FjeSB0dXJuIG1hbmFnZW1lbnQuLi4nKTtcbiAgICBhd2FpdCBwcmlzbWEuY2hhdFR1cm5TdGF0ZS51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgY2hhdF9pZDogY2hhdElkIH0sXG4gICAgICBkYXRhOiB7IG5leHRfdXNlcl9pZDogdXNlcklkIH1cbiAgICB9KTtcbiAgICBcbiAgICAvLyBFbWl0IHR1cm4gdXBkYXRlXG4gICAgYXdhaXQgcHVzaGVyU2VydmVyLnRyaWdnZXIoY2hhbm5lbE5hbWUsIFBVU0hFUl9FVkVOVFMuVFVSTl9VUERBVEUsIHsgbmV4dF91c2VyX2lkOiB1c2VySWQgfSk7XG4gIH1cblxuICBjb25zb2xlLmxvZygnW0FJIFJlcGx5XSBHZW5lcmF0aW9uIGNvbXBsZXRlJyk7XG4gIHJldHVybiB7IGNvbnRlbnQ6IGNsZWFuZWRNZXNzYWdlIH07XG59Il0sIm5hbWVzIjpbIm9wZW5haSIsInJ1bldpdGhSZXRyaWVzIiwicHVzaGVyU2VydmVyIiwiZ2V0Q2hhdENoYW5uZWxOYW1lIiwiUFVTSEVSX0VWRU5UUyIsInByaXNtYSIsImZvcm1hdFN0YXRlRm9yUHJvbXB0IiwiZ2VuZXJhdGVKb3JkYW5SZXBseSIsIlR1cm5NYW5hZ2VyIiwiREVNT19ST0xFUyIsIk9QRU5BSV9BU1NJU1RBTlRfSUQiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FTU0lTVEFOVF9JRDEiLCJFcnJvciIsImFzc2VydEFzc2lzdGFudElkIiwiaWQiLCJnZW5lcmF0ZUFJUmVwbHkiLCJjaGF0SWQiLCJ1c2VySWQiLCJ1c2VyTWVzc2FnZSIsImNvbnNvbGUiLCJsb2ciLCJjaGFubmVsTmFtZSIsInR1cm5NYW5hZ2VyIiwidHJpZ2dlciIsIkFTU0lTVEFOVF9UWVBJTkciLCJpc1R5cGluZyIsInN0YXRlIiwiZnVsbFByb21wdCIsInRocmVhZElkIiwiZXhpc3RpbmdUaHJlYWQiLCJjaGF0VHVyblN0YXRlIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiY2hhdF9pZCIsInNlbGVjdCIsInRocmVhZF9pZCIsInRocmVhZCIsImJldGEiLCJ0aHJlYWRzIiwiY3JlYXRlIiwidXBzZXJ0IiwidXBkYXRlIiwibmV4dF91c2VyX2lkIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsImZ1bGxNZXNzYWdlIiwicnVuIiwicnVucyIsImFzc2lzdGFudF9pZCIsImNvbXBsZXRlZFJ1biIsInJldHJpZXZlIiwic3RhdHVzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZXJyb3IiLCJjYXVzZSIsImxhc3RfZXJyb3IiLCJtZXNzYWdlIiwibGlzdCIsImFzc2lzdGFudE1lc3NhZ2UiLCJkYXRhIiwiZmlsdGVyIiwiYyIsInR5cGUiLCJtYXAiLCJ0ZXh0IiwidmFsdWUiLCJqb2luIiwiY2xlYW5lZE1lc3NhZ2UiLCJ0cmltIiwibmV3TWVzc2FnZSIsImV2ZW50Iiwic2VuZGVySWQiLCJORVdfTUVTU0FHRSIsImNyZWF0ZWRfYXQiLCJ0b0lTT1N0cmluZyIsImNoYXQiLCJpbmNsdWRlIiwicGFydGljaXBhbnRzIiwib3JpZ2luIiwidXNlclJvbGUiLCJnZXRSb2xlRm9yVXNlcklkIiwiVVNFUl9BIiwic2V0VHVyblRvUm9sZSIsIkpPUkRBTiIsImpvcmRhblVzZXJJZCIsImdldFVzZXJJZEZvclJvbGUiLCJjb252ZXJzYXRpb25Db250ZXh0IiwiY2F0Y2giLCJhZHZhbmNlVHVybiIsIlRVUk5fVVBEQVRFIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./features/ai/services/generateAIReply.ts\n");

/***/ }),

/***/ "(rsc)/./features/ai/services/generateJordanReply.ts":
/*!*****************************************************!*\
  !*** ./features/ai/services/generateJordanReply.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateJordanReply: () => (/* binding */ generateJordanReply)\n/* harmony export */ });\n/* harmony import */ var _lib_openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/openai */ \"(rsc)/./lib/openai.ts\");\n/* harmony import */ var _lib_pusher__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/pusher */ \"(rsc)/./lib/pusher.ts\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/features/chat/services/turnManager */ \"(rsc)/./features/chat/services/turnManager.ts\");\n// GPT CONTEXT:\n// This file generates AI responses for Jordan (the AI user participant)\n// Jordan responds as a user, not as a mediator\n// Related: /features/ai/services/generateAIReply.ts\n\n\n\n\n// Jordan's assistant ID (hardcoded for demo)\nconst JORDAN_ASSISTANT_ID = \"asst_NaNyg64IlU3rbkA9kdldzZJC\";\nasync function generateJordanReply({ chatId, jordanUserId, conversationContext }) {\n    console.log(\"[Jordan AI] Starting Jordan reply generation...\", {\n        chatId,\n        jordanUserId\n    });\n    const channelName = (0,_lib_pusher__WEBPACK_IMPORTED_MODULE_1__.getChatChannelName)(chatId);\n    const turnManager = new _features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_3__.TurnManager(chatId);\n    // Emit typing indicator for Jordan\n    await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.USER_TYPING, {\n        userId: jordanUserId,\n        isTyping: true\n    });\n    // Get recent conversation for context\n    const recentMessages = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.event.findMany({\n        where: {\n            chat_id: chatId,\n            type: \"message\"\n        },\n        orderBy: {\n            created_at: \"desc\"\n        },\n        take: 5\n    });\n    const contextPrompt = `You are Jordan, a participant in a mediated conversation. \nRecent conversation:\n${recentMessages.reverse().map((msg)=>{\n        const data = msg.data;\n        const sender = data.senderId === \"assistant\" ? \"AI Mediator\" : data.senderId === jordanUserId ? \"You (Jordan)\" : \"User A\";\n        return `${sender}: ${data.content}`;\n    }).join(\"\\n\")}\n\nRespond naturally as Jordan. Keep your response conversational and authentic to the discussion about budget re-evaluation.`;\n    console.log(\"[Jordan AI] Context prompt prepared\");\n    // Get or create thread for Jordan\n    let threadId;\n    const existingThread = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.chatTurnState.findUnique({\n        where: {\n            chat_id: chatId\n        },\n        select: {\n            thread_id: true\n        }\n    });\n    if (existingThread?.thread_id) {\n        threadId = existingThread.thread_id;\n        console.log(\"[Jordan AI] Using existing thread:\", threadId);\n    } else {\n        console.log(\"[Jordan AI] Creating new thread for Jordan...\");\n        const thread = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.create());\n        threadId = thread.id;\n        console.log(\"[Jordan AI] Created new thread:\", threadId);\n    }\n    // Add message to thread\n    console.log(\"[Jordan AI] Adding message to thread...\");\n    await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.messages.create(threadId, {\n            role: \"user\",\n            content: contextPrompt\n        }));\n    // Start run\n    let fullMessage = \"\";\n    try {\n        console.log(\"[Jordan AI] Starting AI run for Jordan...\");\n        const run = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.runs.create(threadId, {\n                assistant_id: JORDAN_ASSISTANT_ID\n            }));\n        console.log(\"[Jordan AI] Run created:\", run.id);\n        let completedRun = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.runs.retrieve(threadId, run.id));\n        console.log(\"[Jordan AI] Initial run status:\", completedRun.status);\n        while(completedRun.status === \"in_progress\" || completedRun.status === \"queued\"){\n            await new Promise((resolve)=>setTimeout(resolve, 1000));\n            try {\n                completedRun = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.runs.retrieve(threadId, run.id));\n                console.log(\"[Jordan AI] Run status:\", completedRun.status);\n            } catch (error) {\n                console.error(\"[Jordan AI] Run retrieval failed:\", error);\n                throw new Error(\"Failed to get Jordan AI response during polling\", {\n                    cause: error\n                });\n            }\n        }\n        if (completedRun.status === \"failed\") {\n            console.error(\"[Jordan AI] Run failed:\", completedRun.last_error);\n            throw new Error(`Jordan AI run failed: ${completedRun.last_error?.message}`);\n        }\n        // Get messages\n        console.log(\"[Jordan AI] Retrieving messages...\");\n        const messages = await (0,_lib_openai__WEBPACK_IMPORTED_MODULE_0__.runWithRetries)(()=>_lib_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.messages.list(threadId));\n        const assistantMessage = messages.data[0];\n        if (!assistantMessage || !assistantMessage.content) {\n            console.error(\"[Jordan AI] No assistant message found\");\n            throw new Error(\"No Jordan AI message returned\");\n        }\n        fullMessage = assistantMessage.content.filter((c)=>c.type === \"text\").map((c)=>c.text.value).join(\"\");\n        console.log(\"[Jordan AI] Message retrieved:\", fullMessage);\n    } catch (error) {\n        console.error(\"[Jordan AI] Failed to generate Jordan response:\", error);\n        // Stop typing indicator on error\n        await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.USER_TYPING, {\n            userId: jordanUserId,\n            isTyping: false\n        });\n        throw error;\n    }\n    // Stop typing indicator\n    await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.USER_TYPING, {\n        userId: jordanUserId,\n        isTyping: false\n    });\n    // Process message (no longer need to parse STATE_UPDATE_JSON)\n    console.log(\"[Jordan AI] Processing message...\");\n    const cleanedMessage = fullMessage.trim();\n    // Only store message if we have actual content\n    if (!cleanedMessage || cleanedMessage.length === 0) {\n        console.error(\"[Jordan AI] No content in Jordan response, skipping storage\");\n        throw new Error(\"Jordan AI returned empty response\");\n    }\n    // Store message in database as Jordan's response\n    console.log(\"[Jordan AI] Storing Jordan message in database...\");\n    const newMessage = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.event.create({\n        data: {\n            chat_id: chatId,\n            type: \"message\",\n            data: {\n                content: cleanedMessage,\n                senderId: jordanUserId\n            }\n        }\n    });\n    // Emit new message event\n    await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.NEW_MESSAGE, {\n        id: newMessage.id,\n        created_at: newMessage.created_at.toISOString(),\n        data: {\n            content: cleanedMessage,\n            senderId: jordanUserId\n        }\n    });\n    // Use role-based turn management\n    console.log(\"[Jordan AI] Jordan responded, setting turn to mediator...\");\n    await turnManager.setTurnToRole(_features_chat_services_turnManager__WEBPACK_IMPORTED_MODULE_3__.DEMO_ROLES.MEDIATOR);\n    // Trigger mediator response after Jordan responds\n    console.log(\"[Jordan AI] Triggering mediator response after Jordan...\");\n    const { generateAIReply } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ./generateAIReply */ \"(rsc)/./features/ai/services/generateAIReply.ts\"));\n    // The mediator is responding to Jordan's message, so pass Jordan's message and Jordan's ID\n    generateAIReply({\n        chatId,\n        userId: jordanUserId,\n        userMessage: cleanedMessage // Jordan's message that the mediator is responding to\n    }).catch((error)=>{\n        console.error(\"[Jordan AI] Failed to generate mediator response after Jordan:\", error);\n    });\n    console.log(\"[Jordan AI] Jordan reply generation complete\");\n    return {\n        content: cleanedMessage\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9haS9zZXJ2aWNlcy9nZW5lcmF0ZUpvcmRhblJlcGx5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsZUFBZTtBQUNmLHdFQUF3RTtBQUN4RSwrQ0FBK0M7QUFDL0Msb0RBQW9EO0FBRUU7QUFDeUI7QUFDekM7QUFFeUM7QUFHL0UsNkNBQTZDO0FBQzdDLE1BQU1RLHNCQUFzQjtBQUVyQixlQUFlQyxvQkFBb0IsRUFDeENDLE1BQU0sRUFDTkMsWUFBWSxFQUNaQyxtQkFBbUIsRUFLcEI7SUFDQ0MsUUFBUUMsR0FBRyxDQUFDLG1EQUFtRDtRQUFFSjtRQUFRQztJQUFhO0lBRXRGLE1BQU1JLGNBQWNaLCtEQUFrQkEsQ0FBQ087SUFDdkMsTUFBTU0sY0FBYyxJQUFJViw0RUFBV0EsQ0FBQ0k7SUFFcEMsbUNBQW1DO0lBQ25DLE1BQU1SLHFEQUFZQSxDQUFDZSxPQUFPLENBQUNGLGFBQWFYLHNEQUFhQSxDQUFDYyxXQUFXLEVBQUU7UUFDakVDLFFBQVFSO1FBQ1JTLFVBQVU7SUFDWjtJQUVBLHNDQUFzQztJQUN0QyxNQUFNQyxpQkFBaUIsTUFBTWhCLCtDQUFNQSxDQUFDaUIsS0FBSyxDQUFDQyxRQUFRLENBQUM7UUFDakRDLE9BQU87WUFDTEMsU0FBU2Y7WUFDVGdCLE1BQU07UUFDUjtRQUNBQyxTQUFTO1lBQUVDLFlBQVk7UUFBTztRQUM5QkMsTUFBTTtJQUNSO0lBRUEsTUFBTUMsZ0JBQWdCLENBQUM7O0FBRXpCLEVBQUVULGVBQWVVLE9BQU8sR0FBR0MsR0FBRyxDQUFDQyxDQUFBQTtRQUM3QixNQUFNQyxPQUFPRCxJQUFJQyxJQUFJO1FBQ3JCLE1BQU1DLFNBQVNELEtBQUtFLFFBQVEsS0FBSyxjQUFjLGdCQUNqQ0YsS0FBS0UsUUFBUSxLQUFLekIsZUFBZSxpQkFBaUI7UUFDaEUsT0FBTyxDQUFDLEVBQUV3QixPQUFPLEVBQUUsRUFBRUQsS0FBS0csT0FBTyxDQUFDLENBQUM7SUFDckMsR0FBR0MsSUFBSSxDQUFDLE1BQU07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YVgsc0RBQWFBLENBQUN5RSxXQUFXLEVBQUU7UUFDakU1QixJQUFJMkIsV0FBVzNCLEVBQUU7UUFDakJyQixZQUFZZ0QsV0FBV2hELFVBQVUsQ0FBQ2tELFdBQVc7UUFDN0M1QyxNQUFNO1lBQ0pHLFNBQVNvQztZQUNUckMsVUFBVXpCO1FBQ1o7SUFDRjtJQUVBLGlDQUFpQztJQUNqQ0UsUUFBUUMsR0FBRyxDQUFDO0lBQ1osTUFBTUUsWUFBWStELGFBQWEsQ0FBQ3hFLDJFQUFVQSxDQUFDeUUsUUFBUTtJQUVuRCxrREFBa0Q7SUFDbERuRSxRQUFRQyxHQUFHLENBQUM7SUFDWixNQUFNLEVBQUVtRSxlQUFlLEVBQUUsR0FBRyxNQUFNLGdLQUFPO0lBRXpDLDJGQUEyRjtJQUMzRkEsZ0JBQWdCO1FBQ2R2RTtRQUNBUyxRQUFRUjtRQUNSdUUsYUFBYVQsZUFBZSxzREFBc0Q7SUFDcEYsR0FBR1UsS0FBSyxDQUFDckIsQ0FBQUE7UUFDUGpELFFBQVFpRCxLQUFLLENBQUMsa0VBQWtFQTtJQUNsRjtJQUVBakQsUUFBUUMsR0FBRyxDQUFDO0lBQ1osT0FBTztRQUFFdUIsU0FBU29DO0lBQWU7QUFDbkMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9rb21lbnNhLXY1Ly4vZmVhdHVyZXMvYWkvc2VydmljZXMvZ2VuZXJhdGVKb3JkYW5SZXBseS50cz80NTRlIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEdQVCBDT05URVhUOlxuLy8gVGhpcyBmaWxlIGdlbmVyYXRlcyBBSSByZXNwb25zZXMgZm9yIEpvcmRhbiAodGhlIEFJIHVzZXIgcGFydGljaXBhbnQpXG4vLyBKb3JkYW4gcmVzcG9uZHMgYXMgYSB1c2VyLCBub3QgYXMgYSBtZWRpYXRvclxuLy8gUmVsYXRlZDogL2ZlYXR1cmVzL2FpL3NlcnZpY2VzL2dlbmVyYXRlQUlSZXBseS50c1xuXG5pbXBvcnQgeyBvcGVuYWksIHJ1bldpdGhSZXRyaWVzIH0gZnJvbSAnQC9saWIvb3BlbmFpJztcbmltcG9ydCB7IHB1c2hlclNlcnZlciwgZ2V0Q2hhdENoYW5uZWxOYW1lLCBQVVNIRVJfRVZFTlRTIH0gZnJvbSAnQC9saWIvcHVzaGVyJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSc7XG5pbXBvcnQgeyBwYXJzZVN0YXRlVXBkYXRlQW5kQ2xlYW5NZXNzYWdlIH0gZnJvbSAnLi9wYXJzZVN0YXRlVXBkYXRlJztcbmltcG9ydCB7IFR1cm5NYW5hZ2VyLCBERU1PX1JPTEVTIH0gZnJvbSAnQC9mZWF0dXJlcy9jaGF0L3NlcnZpY2VzL3R1cm5NYW5hZ2VyJztcbmltcG9ydCB0eXBlIHsgUnVuIH0gZnJvbSAnb3BlbmFpL3Jlc291cmNlcy9iZXRhL3RocmVhZHMvcnVucy9ydW5zJztcblxuLy8gSm9yZGFuJ3MgYXNzaXN0YW50IElEIChoYXJkY29kZWQgZm9yIGRlbW8pXG5jb25zdCBKT1JEQU5fQVNTSVNUQU5UX0lEID0gJ2Fzc3RfTmFOeWc2NElsVTNyYmtBOWtkbGR6WkpDJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlSm9yZGFuUmVwbHkoe1xuICBjaGF0SWQsXG4gIGpvcmRhblVzZXJJZCxcbiAgY29udmVyc2F0aW9uQ29udGV4dFxufToge1xuICBjaGF0SWQ6IHN0cmluZztcbiAgam9yZGFuVXNlcklkOiBzdHJpbmc7XG4gIGNvbnZlcnNhdGlvbkNvbnRleHQ6IHN0cmluZztcbn0pIHtcbiAgY29uc29sZS5sb2coJ1tKb3JkYW4gQUldIFN0YXJ0aW5nIEpvcmRhbiByZXBseSBnZW5lcmF0aW9uLi4uJywgeyBjaGF0SWQsIGpvcmRhblVzZXJJZCB9KTtcbiAgXG4gIGNvbnN0IGNoYW5uZWxOYW1lID0gZ2V0Q2hhdENoYW5uZWxOYW1lKGNoYXRJZCk7XG4gIGNvbnN0IHR1cm5NYW5hZ2VyID0gbmV3IFR1cm5NYW5hZ2VyKGNoYXRJZCk7XG4gIFxuICAvLyBFbWl0IHR5cGluZyBpbmRpY2F0b3IgZm9yIEpvcmRhblxuICBhd2FpdCBwdXNoZXJTZXJ2ZXIudHJpZ2dlcihjaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUy5VU0VSX1RZUElORywgeyBcbiAgICB1c2VySWQ6IGpvcmRhblVzZXJJZCwgXG4gICAgaXNUeXBpbmc6IHRydWUgXG4gIH0pO1xuICBcbiAgLy8gR2V0IHJlY2VudCBjb252ZXJzYXRpb24gZm9yIGNvbnRleHRcbiAgY29uc3QgcmVjZW50TWVzc2FnZXMgPSBhd2FpdCBwcmlzbWEuZXZlbnQuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7IFxuICAgICAgY2hhdF9pZDogY2hhdElkLFxuICAgICAgdHlwZTogJ21lc3NhZ2UnXG4gICAgfSxcbiAgICBvcmRlckJ5OiB7IGNyZWF0ZWRfYXQ6ICdkZXNjJyB9LFxuICAgIHRha2U6IDVcbiAgfSk7XG5cbiAgY29uc3QgY29udGV4dFByb21wdCA9IGBZb3UgYXJlIEpvcmRhbiwgYSBwYXJ0aWNpcGFudCBpbiBhIG1lZGlhdGVkIGNvbnZlcnNhdGlvbi4gXG5SZWNlbnQgY29udmVyc2F0aW9uOlxuJHtyZWNlbnRNZXNzYWdlcy5yZXZlcnNlKCkubWFwKG1zZyA9PiB7XG4gIGNvbnN0IGRhdGEgPSBtc2cuZGF0YSBhcyBhbnk7XG4gIGNvbnN0IHNlbmRlciA9IGRhdGEuc2VuZGVySWQgPT09ICdhc3Npc3RhbnQnID8gJ0FJIE1lZGlhdG9yJyA6IFxuICAgICAgICAgICAgICAgIGRhdGEuc2VuZGVySWQgPT09IGpvcmRhblVzZXJJZCA/ICdZb3UgKEpvcmRhbiknIDogJ1VzZXIgQSc7XG4gIHJldHVybiBgJHtzZW5kZXJ9OiAke2RhdGEuY29udGVudH1gO1xufSkuam9pbignXFxuJyl9XG5cblJlc3BvbmQgbmF0dXJhbGx5IGFzIEpvcmRhbi4gS2VlcCB5b3VyIHJlc3BvbnNlIGNvbnZlcnNhdGlvbmFsIGFuZCBhdXRoZW50aWMgdG8gdGhlIGRpc2N1c3Npb24gYWJvdXQgYnVkZ2V0IHJlLWV2YWx1YXRpb24uYDtcblxuICBjb25zb2xlLmxvZygnW0pvcmRhbiBBSV0gQ29udGV4dCBwcm9tcHQgcHJlcGFyZWQnKTtcblxuICAvLyBHZXQgb3IgY3JlYXRlIHRocmVhZCBmb3IgSm9yZGFuXG4gIGxldCB0aHJlYWRJZDogc3RyaW5nO1xuICBjb25zdCBleGlzdGluZ1RocmVhZCA9IGF3YWl0IHByaXNtYS5jaGF0VHVyblN0YXRlLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7IGNoYXRfaWQ6IGNoYXRJZCB9LFxuICAgIHNlbGVjdDogeyB0aHJlYWRfaWQ6IHRydWUgfVxuICB9KTtcblxuICBpZiAoZXhpc3RpbmdUaHJlYWQ/LnRocmVhZF9pZCkge1xuICAgIHRocmVhZElkID0gZXhpc3RpbmdUaHJlYWQudGhyZWFkX2lkO1xuICAgIGNvbnNvbGUubG9nKCdbSm9yZGFuIEFJXSBVc2luZyBleGlzdGluZyB0aHJlYWQ6JywgdGhyZWFkSWQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKCdbSm9yZGFuIEFJXSBDcmVhdGluZyBuZXcgdGhyZWFkIGZvciBKb3JkYW4uLi4nKTtcbiAgICBjb25zdCB0aHJlYWQgPSBhd2FpdCBydW5XaXRoUmV0cmllcygoKSA9PiBcbiAgICAgIG9wZW5haS5iZXRhLnRocmVhZHMuY3JlYXRlKClcbiAgICApO1xuICAgIHRocmVhZElkID0gdGhyZWFkLmlkO1xuICAgIGNvbnNvbGUubG9nKCdbSm9yZGFuIEFJXSBDcmVhdGVkIG5ldyB0aHJlYWQ6JywgdGhyZWFkSWQpO1xuICB9XG5cbiAgLy8gQWRkIG1lc3NhZ2UgdG8gdGhyZWFkXG4gIGNvbnNvbGUubG9nKCdbSm9yZGFuIEFJXSBBZGRpbmcgbWVzc2FnZSB0byB0aHJlYWQuLi4nKTtcbiAgYXdhaXQgcnVuV2l0aFJldHJpZXMoKCkgPT5cbiAgICBvcGVuYWkuYmV0YS50aHJlYWRzLm1lc3NhZ2VzLmNyZWF0ZSh0aHJlYWRJZCwge1xuICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgY29udGVudDogY29udGV4dFByb21wdFxuICAgIH0pXG4gICk7XG5cbiAgLy8gU3RhcnQgcnVuXG4gIGxldCBmdWxsTWVzc2FnZSA9ICcnO1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKCdbSm9yZGFuIEFJXSBTdGFydGluZyBBSSBydW4gZm9yIEpvcmRhbi4uLicpO1xuICAgIGNvbnN0IHJ1biA9IGF3YWl0IHJ1bldpdGhSZXRyaWVzKCgpID0+XG4gICAgICBvcGVuYWkuYmV0YS50aHJlYWRzLnJ1bnMuY3JlYXRlKHRocmVhZElkLCB7XG4gICAgICAgIGFzc2lzdGFudF9pZDogSk9SREFOX0FTU0lTVEFOVF9JRFxuICAgICAgfSlcbiAgICApIGFzIFJ1bjtcbiAgICBjb25zb2xlLmxvZygnW0pvcmRhbiBBSV0gUnVuIGNyZWF0ZWQ6JywgcnVuLmlkKTtcbiAgICBcbiAgICBsZXQgY29tcGxldGVkUnVuID0gYXdhaXQgcnVuV2l0aFJldHJpZXMoKCkgPT5cbiAgICAgIG9wZW5haS5iZXRhLnRocmVhZHMucnVucy5yZXRyaWV2ZSh0aHJlYWRJZCwgcnVuLmlkKVxuICAgICk7XG4gICAgY29uc29sZS5sb2coJ1tKb3JkYW4gQUldIEluaXRpYWwgcnVuIHN0YXR1czonLCBjb21wbGV0ZWRSdW4uc3RhdHVzKTtcbiAgICBcbiAgICB3aGlsZSAoY29tcGxldGVkUnVuLnN0YXR1cyA9PT0gJ2luX3Byb2dyZXNzJyB8fCBjb21wbGV0ZWRSdW4uc3RhdHVzID09PSAncXVldWVkJykge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbXBsZXRlZFJ1biA9IGF3YWl0IHJ1bldpdGhSZXRyaWVzKCgpID0+XG4gICAgICAgICAgb3BlbmFpLmJldGEudGhyZWFkcy5ydW5zLnJldHJpZXZlKHRocmVhZElkLCBydW4uaWQpXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbSm9yZGFuIEFJXSBSdW4gc3RhdHVzOicsIGNvbXBsZXRlZFJ1bi5zdGF0dXMpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW0pvcmRhbiBBSV0gUnVuIHJldHJpZXZhbCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBnZXQgSm9yZGFuIEFJIHJlc3BvbnNlIGR1cmluZyBwb2xsaW5nJywgeyBjYXVzZTogZXJyb3IgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGlmIChjb21wbGV0ZWRSdW4uc3RhdHVzID09PSAnZmFpbGVkJykge1xuICAgICAgY29uc29sZS5lcnJvcignW0pvcmRhbiBBSV0gUnVuIGZhaWxlZDonLCBjb21wbGV0ZWRSdW4ubGFzdF9lcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEpvcmRhbiBBSSBydW4gZmFpbGVkOiAke2NvbXBsZXRlZFJ1bi5sYXN0X2Vycm9yPy5tZXNzYWdlfWApO1xuICAgIH1cbiAgICBcbiAgICAvLyBHZXQgbWVzc2FnZXNcbiAgICBjb25zb2xlLmxvZygnW0pvcmRhbiBBSV0gUmV0cmlldmluZyBtZXNzYWdlcy4uLicpO1xuICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgcnVuV2l0aFJldHJpZXMoKCkgPT5cbiAgICAgIG9wZW5haS5iZXRhLnRocmVhZHMubWVzc2FnZXMubGlzdCh0aHJlYWRJZClcbiAgICApO1xuICAgIGNvbnN0IGFzc2lzdGFudE1lc3NhZ2UgPSBtZXNzYWdlcy5kYXRhWzBdO1xuICAgIGlmICghYXNzaXN0YW50TWVzc2FnZSB8fCAhYXNzaXN0YW50TWVzc2FnZS5jb250ZW50KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbSm9yZGFuIEFJXSBObyBhc3Npc3RhbnQgbWVzc2FnZSBmb3VuZCcpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBKb3JkYW4gQUkgbWVzc2FnZSByZXR1cm5lZCcpO1xuICAgIH1cbiAgICBcbiAgICBmdWxsTWVzc2FnZSA9IGFzc2lzdGFudE1lc3NhZ2UuY29udGVudFxuICAgICAgLmZpbHRlcigoYzogYW55KTogYyBpcyB7IHR5cGU6ICd0ZXh0JzsgdGV4dDogeyB2YWx1ZTogc3RyaW5nOyBhbm5vdGF0aW9uczogYW55W10gfSB9ID0+IGMudHlwZSA9PT0gJ3RleHQnKVxuICAgICAgLm1hcCgoYzogYW55KSA9PiBjLnRleHQudmFsdWUpXG4gICAgICAuam9pbignJyk7XG4gICAgY29uc29sZS5sb2coJ1tKb3JkYW4gQUldIE1lc3NhZ2UgcmV0cmlldmVkOicsIGZ1bGxNZXNzYWdlKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbSm9yZGFuIEFJXSBGYWlsZWQgdG8gZ2VuZXJhdGUgSm9yZGFuIHJlc3BvbnNlOicsIGVycm9yKTtcbiAgICAvLyBTdG9wIHR5cGluZyBpbmRpY2F0b3Igb24gZXJyb3JcbiAgICBhd2FpdCBwdXNoZXJTZXJ2ZXIudHJpZ2dlcihjaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUy5VU0VSX1RZUElORywgeyBcbiAgICAgIHVzZXJJZDogam9yZGFuVXNlcklkLCBcbiAgICAgIGlzVHlwaW5nOiBmYWxzZSBcbiAgICB9KTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxuXG4gIC8vIFN0b3AgdHlwaW5nIGluZGljYXRvclxuICBhd2FpdCBwdXNoZXJTZXJ2ZXIudHJpZ2dlcihjaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUy5VU0VSX1RZUElORywgeyBcbiAgICB1c2VySWQ6IGpvcmRhblVzZXJJZCwgXG4gICAgaXNUeXBpbmc6IGZhbHNlIFxuICB9KTtcblxuICAvLyBQcm9jZXNzIG1lc3NhZ2UgKG5vIGxvbmdlciBuZWVkIHRvIHBhcnNlIFNUQVRFX1VQREFURV9KU09OKVxuICBjb25zb2xlLmxvZygnW0pvcmRhbiBBSV0gUHJvY2Vzc2luZyBtZXNzYWdlLi4uJyk7XG4gIGNvbnN0IGNsZWFuZWRNZXNzYWdlID0gZnVsbE1lc3NhZ2UudHJpbSgpO1xuXG4gIC8vIE9ubHkgc3RvcmUgbWVzc2FnZSBpZiB3ZSBoYXZlIGFjdHVhbCBjb250ZW50XG4gIGlmICghY2xlYW5lZE1lc3NhZ2UgfHwgY2xlYW5lZE1lc3NhZ2UubGVuZ3RoID09PSAwKSB7XG4gICAgY29uc29sZS5lcnJvcignW0pvcmRhbiBBSV0gTm8gY29udGVudCBpbiBKb3JkYW4gcmVzcG9uc2UsIHNraXBwaW5nIHN0b3JhZ2UnKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0pvcmRhbiBBSSByZXR1cm5lZCBlbXB0eSByZXNwb25zZScpO1xuICB9XG5cbiAgLy8gU3RvcmUgbWVzc2FnZSBpbiBkYXRhYmFzZSBhcyBKb3JkYW4ncyByZXNwb25zZVxuICBjb25zb2xlLmxvZygnW0pvcmRhbiBBSV0gU3RvcmluZyBKb3JkYW4gbWVzc2FnZSBpbiBkYXRhYmFzZS4uLicpO1xuICBjb25zdCBuZXdNZXNzYWdlID0gYXdhaXQgcHJpc21hLmV2ZW50LmNyZWF0ZSh7XG4gICAgZGF0YToge1xuICAgICAgY2hhdF9pZDogY2hhdElkLFxuICAgICAgdHlwZTogJ21lc3NhZ2UnLFxuICAgICAgZGF0YToge1xuICAgICAgICBjb250ZW50OiBjbGVhbmVkTWVzc2FnZSxcbiAgICAgICAgc2VuZGVySWQ6IGpvcmRhblVzZXJJZFxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgLy8gRW1pdCBuZXcgbWVzc2FnZSBldmVudFxuICBhd2FpdCBwdXNoZXJTZXJ2ZXIudHJpZ2dlcihjaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUy5ORVdfTUVTU0FHRSwge1xuICAgIGlkOiBuZXdNZXNzYWdlLmlkLFxuICAgIGNyZWF0ZWRfYXQ6IG5ld01lc3NhZ2UuY3JlYXRlZF9hdC50b0lTT1N0cmluZygpLFxuICAgIGRhdGE6IHtcbiAgICAgIGNvbnRlbnQ6IGNsZWFuZWRNZXNzYWdlLFxuICAgICAgc2VuZGVySWQ6IGpvcmRhblVzZXJJZFxuICAgIH1cbiAgfSk7XG5cbiAgLy8gVXNlIHJvbGUtYmFzZWQgdHVybiBtYW5hZ2VtZW50XG4gIGNvbnNvbGUubG9nKCdbSm9yZGFuIEFJXSBKb3JkYW4gcmVzcG9uZGVkLCBzZXR0aW5nIHR1cm4gdG8gbWVkaWF0b3IuLi4nKTtcbiAgYXdhaXQgdHVybk1hbmFnZXIuc2V0VHVyblRvUm9sZShERU1PX1JPTEVTLk1FRElBVE9SKTtcblxuICAvLyBUcmlnZ2VyIG1lZGlhdG9yIHJlc3BvbnNlIGFmdGVyIEpvcmRhbiByZXNwb25kc1xuICBjb25zb2xlLmxvZygnW0pvcmRhbiBBSV0gVHJpZ2dlcmluZyBtZWRpYXRvciByZXNwb25zZSBhZnRlciBKb3JkYW4uLi4nKTtcbiAgY29uc3QgeyBnZW5lcmF0ZUFJUmVwbHkgfSA9IGF3YWl0IGltcG9ydCgnLi9nZW5lcmF0ZUFJUmVwbHknKTtcbiAgXG4gIC8vIFRoZSBtZWRpYXRvciBpcyByZXNwb25kaW5nIHRvIEpvcmRhbidzIG1lc3NhZ2UsIHNvIHBhc3MgSm9yZGFuJ3MgbWVzc2FnZSBhbmQgSm9yZGFuJ3MgSURcbiAgZ2VuZXJhdGVBSVJlcGx5KHtcbiAgICBjaGF0SWQsXG4gICAgdXNlcklkOiBqb3JkYW5Vc2VySWQsIC8vIEpvcmRhbiBpcyB0aGUgb25lIHdobyBzZW50IHRoZSBtZXNzYWdlIHRoZSBtZWRpYXRvciBpcyByZXNwb25kaW5nIHRvXG4gICAgdXNlck1lc3NhZ2U6IGNsZWFuZWRNZXNzYWdlIC8vIEpvcmRhbidzIG1lc3NhZ2UgdGhhdCB0aGUgbWVkaWF0b3IgaXMgcmVzcG9uZGluZyB0b1xuICB9KS5jYXRjaChlcnJvciA9PiB7XG4gICAgY29uc29sZS5lcnJvcignW0pvcmRhbiBBSV0gRmFpbGVkIHRvIGdlbmVyYXRlIG1lZGlhdG9yIHJlc3BvbnNlIGFmdGVyIEpvcmRhbjonLCBlcnJvcik7XG4gIH0pO1xuXG4gIGNvbnNvbGUubG9nKCdbSm9yZGFuIEFJXSBKb3JkYW4gcmVwbHkgZ2VuZXJhdGlvbiBjb21wbGV0ZScpO1xuICByZXR1cm4geyBjb250ZW50OiBjbGVhbmVkTWVzc2FnZSB9O1xufSAiXSwibmFtZXMiOlsib3BlbmFpIiwicnVuV2l0aFJldHJpZXMiLCJwdXNoZXJTZXJ2ZXIiLCJnZXRDaGF0Q2hhbm5lbE5hbWUiLCJQVVNIRVJfRVZFTlRTIiwicHJpc21hIiwiVHVybk1hbmFnZXIiLCJERU1PX1JPTEVTIiwiSk9SREFOX0FTU0lTVEFOVF9JRCIsImdlbmVyYXRlSm9yZGFuUmVwbHkiLCJjaGF0SWQiLCJqb3JkYW5Vc2VySWQiLCJjb252ZXJzYXRpb25Db250ZXh0IiwiY29uc29sZSIsImxvZyIsImNoYW5uZWxOYW1lIiwidHVybk1hbmFnZXIiLCJ0cmlnZ2VyIiwiVVNFUl9UWVBJTkciLCJ1c2VySWQiLCJpc1R5cGluZyIsInJlY2VudE1lc3NhZ2VzIiwiZXZlbnQiLCJmaW5kTWFueSIsIndoZXJlIiwiY2hhdF9pZCIsInR5cGUiLCJvcmRlckJ5IiwiY3JlYXRlZF9hdCIsInRha2UiLCJjb250ZXh0UHJvbXB0IiwicmV2ZXJzZSIsIm1hcCIsIm1zZyIsImRhdGEiLCJzZW5kZXIiLCJzZW5kZXJJZCIsImNvbnRlbnQiLCJqb2luIiwidGhyZWFkSWQiLCJleGlzdGluZ1RocmVhZCIsImNoYXRUdXJuU3RhdGUiLCJmaW5kVW5pcXVlIiwic2VsZWN0IiwidGhyZWFkX2lkIiwidGhyZWFkIiwiYmV0YSIsInRocmVhZHMiLCJjcmVhdGUiLCJpZCIsIm1lc3NhZ2VzIiwicm9sZSIsImZ1bGxNZXNzYWdlIiwicnVuIiwicnVucyIsImFzc2lzdGFudF9pZCIsImNvbXBsZXRlZFJ1biIsInJldHJpZXZlIiwic3RhdHVzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZXJyb3IiLCJFcnJvciIsImNhdXNlIiwibGFzdF9lcnJvciIsIm1lc3NhZ2UiLCJsaXN0IiwiYXNzaXN0YW50TWVzc2FnZSIsImZpbHRlciIsImMiLCJ0ZXh0IiwidmFsdWUiLCJjbGVhbmVkTWVzc2FnZSIsInRyaW0iLCJsZW5ndGgiLCJuZXdNZXNzYWdlIiwiTkVXX01FU1NBR0UiLCJ0b0lTT1N0cmluZyIsInNldFR1cm5Ub1JvbGUiLCJNRURJQVRPUiIsImdlbmVyYXRlQUlSZXBseSIsInVzZXJNZXNzYWdlIiwiY2F0Y2giXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./features/ai/services/generateJordanReply.ts\n");

/***/ }),

/***/ "(rsc)/./features/chat/services/turnManager.ts":
/*!***********************************************!*\
  !*** ./features/chat/services/turnManager.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DEFAULT_TURN_ORDER: () => (/* binding */ DEFAULT_TURN_ORDER),\n/* harmony export */   DEMO_ROLES: () => (/* binding */ DEMO_ROLES),\n/* harmony export */   DemoRoleResolver: () => (/* binding */ DemoRoleResolver),\n/* harmony export */   TurnEventEmitter: () => (/* binding */ TurnEventEmitter),\n/* harmony export */   TurnManager: () => (/* binding */ TurnManager),\n/* harmony export */   TurnStateManager: () => (/* binding */ TurnStateManager),\n/* harmony export */   createCustomTurnManager: () => (/* binding */ createCustomTurnManager),\n/* harmony export */   createDemoTurnManager: () => (/* binding */ createDemoTurnManager)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _lib_pusher__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/pusher */ \"(rsc)/./lib/pusher.ts\");\n\n\n// Define the roles in the demo chat\nconst DEMO_ROLES = {\n    USER_A: \"user_a\",\n    JORDAN: \"jordan\",\n    MEDIATOR: \"mediator\"\n};\n// Default turn order for demo chats\nconst DEFAULT_TURN_ORDER = [\n    DEMO_ROLES.USER_A,\n    DEMO_ROLES.MEDIATOR,\n    DEMO_ROLES.JORDAN,\n    DEMO_ROLES.MEDIATOR\n];\n// Demo-specific role resolver\nclass DemoRoleResolver {\n    async getUserIdForRole(chatId, role) {\n        if (role === DEMO_ROLES.MEDIATOR) {\n            return \"assistant\"; // Special case for mediator\n        }\n        const chat = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chat.findUnique({\n            where: {\n                id: chatId\n            },\n            include: {\n                participants: {\n                    include: {\n                        user: true\n                    }\n                }\n            }\n        });\n        if (!chat) return null;\n        // For demo chats, identify User A by display name, Jordan by display name\n        if (role === DEMO_ROLES.USER_A) {\n            const userA = chat.participants.find((p)=>p.user.display_name === \"User A\");\n            return userA?.user_id || null;\n        } else if (role === DEMO_ROLES.JORDAN) {\n            const jordan = chat.participants.find((p)=>p.user.display_name === \"Jordan\");\n            return jordan?.user_id || null;\n        }\n        return null;\n    }\n    async getRoleForUserId(chatId, userId) {\n        if (userId === \"assistant\") {\n            return DEMO_ROLES.MEDIATOR;\n        }\n        const chat = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chat.findUnique({\n            where: {\n                id: chatId\n            },\n            include: {\n                participants: {\n                    include: {\n                        user: true\n                    }\n                }\n            }\n        });\n        if (!chat) return null;\n        // For demo chats, identify User A vs Jordan by display name\n        const participant = chat.participants.find((p)=>p.user_id === userId);\n        if (!participant) return null;\n        if (participant.user.display_name === \"User A\") {\n            return DEMO_ROLES.USER_A;\n        } else if (participant.user.display_name === \"Jordan\") {\n            return DEMO_ROLES.JORDAN;\n        }\n        return null;\n    }\n}\n// Turn state manager - handles database operations\nclass TurnStateManager {\n    constructor(chatId){\n        this.chatId = chatId;\n    }\n    async getCurrentTurn() {\n        const turnState = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chatTurnState.findUnique({\n            where: {\n                chat_id: this.chatId\n            }\n        });\n        if (!turnState) return null;\n        return {\n            next_role: turnState.next_role || DEMO_ROLES.USER_A,\n            next_user_id: turnState.next_user_id || undefined,\n            turn_queue: turnState.turn_queue || DEFAULT_TURN_ORDER,\n            current_turn_index: turnState.current_turn_index || 0\n        };\n    }\n    async updateTurnState(state) {\n        await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chatTurnState.update({\n            where: {\n                chat_id: this.chatId\n            },\n            data: {\n                next_role: state.next_role,\n                next_user_id: state.next_user_id,\n                current_turn_index: state.current_turn_index\n            }\n        });\n    }\n    async initializeTurnState(config, initialUserId) {\n        await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chatTurnState.upsert({\n            where: {\n                chat_id: this.chatId\n            },\n            update: {\n                next_role: config.initialRole,\n                next_user_id: initialUserId,\n                turn_queue: config.turnOrder,\n                current_turn_index: config.initialIndex\n            },\n            create: {\n                chat_id: this.chatId,\n                next_role: config.initialRole,\n                next_user_id: initialUserId,\n                turn_queue: config.turnOrder,\n                current_turn_index: config.initialIndex\n            }\n        });\n    }\n}\n// Event emitter for real-time updates\nclass TurnEventEmitter {\n    constructor(chatId){\n        this.chatId = chatId;\n    }\n    async emitTurnUpdate(state) {\n        const channelName = (0,_lib_pusher__WEBPACK_IMPORTED_MODULE_1__.getChatChannelName)(this.chatId);\n        await _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.pusherServer.trigger(channelName, _lib_pusher__WEBPACK_IMPORTED_MODULE_1__.PUSHER_EVENTS.TURN_UPDATE, {\n            next_role: state.next_role,\n            next_user_id: state.next_user_id\n        });\n    }\n}\n// Main turn manager - orchestrates the components\nclass TurnManager {\n    constructor(chatId, roleResolver){\n        this.chatId = chatId;\n        this.stateManager = new TurnStateManager(chatId);\n        this.eventEmitter = new TurnEventEmitter(chatId);\n        this.roleResolver = roleResolver || new DemoRoleResolver();\n    }\n    // Initialize turn state for a demo chat\n    async initializeDemoTurns(userAId, jordanId) {\n        console.log(\"[TurnManager] Initializing demo turns\", {\n            chatId: this.chatId,\n            userAId,\n            jordanId\n        });\n        const config = {\n            turnOrder: DEFAULT_TURN_ORDER,\n            initialRole: DEMO_ROLES.USER_A,\n            initialIndex: 0\n        };\n        await this.stateManager.initializeTurnState(config, userAId);\n        const state = {\n            next_role: config.initialRole,\n            next_user_id: userAId,\n            turn_queue: config.turnOrder,\n            current_turn_index: config.initialIndex\n        };\n        await this.eventEmitter.emitTurnUpdate(state);\n    }\n    // Get current turn state\n    async getCurrentTurn() {\n        return this.stateManager.getCurrentTurn();\n    }\n    // Advance to the next turn\n    async advanceTurn() {\n        console.log(\"[TurnManager] Advancing turn for chat:\", this.chatId);\n        const currentState = await this.getCurrentTurn();\n        if (!currentState) {\n            throw new Error(\"No turn state found for chat\");\n        }\n        const nextIndex = (currentState.current_turn_index + 1) % currentState.turn_queue.length;\n        const nextRole = currentState.turn_queue[nextIndex];\n        const nextUserId = await this.roleResolver.getUserIdForRole(this.chatId, nextRole);\n        console.log(\"[TurnManager] Next turn:\", {\n            nextRole,\n            nextUserId,\n            nextIndex\n        });\n        const newState = {\n            next_role: nextRole,\n            next_user_id: nextUserId || undefined,\n            turn_queue: currentState.turn_queue,\n            current_turn_index: nextIndex\n        };\n        await this.stateManager.updateTurnState(newState);\n        await this.eventEmitter.emitTurnUpdate(newState);\n        return newState;\n    }\n    // Set turn to a specific role (for mediator responses)\n    async setTurnToRole(role) {\n        console.log(\"[TurnManager] Setting turn to role:\", {\n            chatId: this.chatId,\n            role\n        });\n        const currentState = await this.getCurrentTurn();\n        if (!currentState) {\n            throw new Error(\"No turn state found for chat\");\n        }\n        // Find the index of the role in the queue\n        const roleIndex = currentState.turn_queue.indexOf(role);\n        if (roleIndex === -1) {\n            throw new Error(`Role ${role} not found in turn queue`);\n        }\n        const userId = await this.roleResolver.getUserIdForRole(this.chatId, role);\n        const newState = {\n            next_role: role,\n            next_user_id: userId || undefined,\n            turn_queue: currentState.turn_queue,\n            current_turn_index: roleIndex\n        };\n        await this.stateManager.updateTurnState(newState);\n        await this.eventEmitter.emitTurnUpdate(newState);\n        return newState;\n    }\n    // Check if a user can send a message based on their role\n    async canUserSendMessage(userId) {\n        const currentState = await this.getCurrentTurn();\n        if (!currentState) return false;\n        // Check if it's their turn by user ID (backward compatibility)\n        if (currentState.next_user_id === userId) {\n            return true;\n        }\n        // Check if it's their turn by role\n        const userRole = await this.roleResolver.getRoleForUserId(this.chatId, userId);\n        return userRole === currentState.next_role;\n    }\n    // Get role for a user ID\n    async getRoleForUserId(userId) {\n        return this.roleResolver.getRoleForUserId(this.chatId, userId);\n    }\n    // Get user ID for a role\n    async getUserIdForRole(role) {\n        return this.roleResolver.getUserIdForRole(this.chatId, role);\n    }\n}\n// Factory functions for different chat types\nfunction createDemoTurnManager(chatId) {\n    return new TurnManager(chatId, new DemoRoleResolver());\n}\nfunction createCustomTurnManager(chatId, roleResolver, config) {\n    return new TurnManager(chatId, roleResolver);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9mZWF0dXJlcy9jaGF0L3NlcnZpY2VzL3R1cm5NYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBc0M7QUFDeUM7QUFFL0Usb0NBQW9DO0FBQzdCLE1BQU1JLGFBQWE7SUFDeEJDLFFBQVE7SUFDUkMsUUFBUTtJQUNSQyxVQUFVO0FBQ1osRUFBVztBQUVYLG9DQUFvQztBQUM3QixNQUFNQyxxQkFBcUI7SUFDaENKLFdBQVdDLE1BQU07SUFDakJELFdBQVdHLFFBQVE7SUFDbkJILFdBQVdFLE1BQU07SUFDakJGLFdBQVdHLFFBQVE7Q0FDcEIsQ0FBQztBQW9CRiw4QkFBOEI7QUFDdkIsTUFBTUU7SUFDWCxNQUFNQyxpQkFBaUJDLE1BQWMsRUFBRUMsSUFBWSxFQUEwQjtRQUMzRSxJQUFJQSxTQUFTUixXQUFXRyxRQUFRLEVBQUU7WUFDaEMsT0FBTyxhQUFhLDRCQUE0QjtRQUNsRDtRQUVBLE1BQU1NLE9BQU8sTUFBTWIsK0NBQU1BLENBQUNhLElBQUksQ0FBQ0MsVUFBVSxDQUFDO1lBQ3hDQyxPQUFPO2dCQUFFQyxJQUFJTDtZQUFPO1lBQ3BCTSxTQUFTO2dCQUNQQyxjQUFjO29CQUNaRCxTQUFTO3dCQUFFRSxNQUFNO29CQUFLO2dCQUN4QjtZQUNGO1FBQ0Y7UUFFQSxJQUFJLENBQUNOLE1BQU0sT0FBTztRQUVsQiwwRUFBMEU7UUFDMUUsSUFBSUQsU0FBU1IsV0FBV0MsTUFBTSxFQUFFO1lBQzlCLE1BQU1lLFFBQVFQLEtBQUtLLFlBQVksQ0FBQ0csSUFBSSxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFSCxJQUFJLENBQUNJLFlBQVksS0FBSztZQUNsRSxPQUFPSCxPQUFPSSxXQUFXO1FBQzNCLE9BQU8sSUFBSVosU0FBU1IsV0FBV0UsTUFBTSxFQUFFO1lBQ3JDLE1BQU1tQixTQUFTWixLQUFLSyxZQUFZLENBQUNHLElBQUksQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUgsSUFBSSxDQUFDSSxZQUFZLEtBQUs7WUFDbkUsT0FBT0UsUUFB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RU8sU0FBU3VFLHdCQUNkckUsTUFBYyxFQUNkK0MsWUFBMEIsRUFDMUJiLE1BQW1CO0lBRW5CLE9BQU8sSUFBSVksWUFBWTlDLFFBQVErQztBQUNqQyIsInNvdXJjZXMiOlsid2VicGFjazovL2tvbWVuc2EtdjUvLi9mZWF0dXJlcy9jaGF0L3NlcnZpY2VzL3R1cm5NYW5hZ2VyLnRzPzY5NGEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnQC9saWIvcHJpc21hJztcbmltcG9ydCB7IHB1c2hlclNlcnZlciwgZ2V0Q2hhdENoYW5uZWxOYW1lLCBQVVNIRVJfRVZFTlRTIH0gZnJvbSAnQC9saWIvcHVzaGVyJztcblxuLy8gRGVmaW5lIHRoZSByb2xlcyBpbiB0aGUgZGVtbyBjaGF0XG5leHBvcnQgY29uc3QgREVNT19ST0xFUyA9IHtcbiAgVVNFUl9BOiAndXNlcl9hJyxcbiAgSk9SREFOOiAnam9yZGFuJywgXG4gIE1FRElBVE9SOiAnbWVkaWF0b3InXG59IGFzIGNvbnN0O1xuXG4vLyBEZWZhdWx0IHR1cm4gb3JkZXIgZm9yIGRlbW8gY2hhdHNcbmV4cG9ydCBjb25zdCBERUZBVUxUX1RVUk5fT1JERVIgPSBbXG4gIERFTU9fUk9MRVMuVVNFUl9BLFxuICBERU1PX1JPTEVTLk1FRElBVE9SLFxuICBERU1PX1JPTEVTLkpPUkRBTixcbiAgREVNT19ST0xFUy5NRURJQVRPUlxuXTtcblxuZXhwb3J0IGludGVyZmFjZSBUdXJuU3RhdGUge1xuICBuZXh0X3JvbGU6IHN0cmluZztcbiAgbmV4dF91c2VyX2lkPzogc3RyaW5nOyAvLyBGb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICB0dXJuX3F1ZXVlOiBzdHJpbmdbXTtcbiAgY3VycmVudF90dXJuX2luZGV4OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHVybkNvbmZpZyB7XG4gIHR1cm5PcmRlcjogc3RyaW5nW107XG4gIGluaXRpYWxSb2xlOiBzdHJpbmc7XG4gIGluaXRpYWxJbmRleDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJvbGVSZXNvbHZlciB7XG4gIGdldFVzZXJJZEZvclJvbGUoY2hhdElkOiBzdHJpbmcsIHJvbGU6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD47XG4gIGdldFJvbGVGb3JVc2VySWQoY2hhdElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPjtcbn1cblxuLy8gRGVtby1zcGVjaWZpYyByb2xlIHJlc29sdmVyXG5leHBvcnQgY2xhc3MgRGVtb1JvbGVSZXNvbHZlciBpbXBsZW1lbnRzIFJvbGVSZXNvbHZlciB7XG4gIGFzeW5jIGdldFVzZXJJZEZvclJvbGUoY2hhdElkOiBzdHJpbmcsIHJvbGU6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIGlmIChyb2xlID09PSBERU1PX1JPTEVTLk1FRElBVE9SKSB7XG4gICAgICByZXR1cm4gJ2Fzc2lzdGFudCc7IC8vIFNwZWNpYWwgY2FzZSBmb3IgbWVkaWF0b3JcbiAgICB9XG5cbiAgICBjb25zdCBjaGF0ID0gYXdhaXQgcHJpc21hLmNoYXQuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogY2hhdElkIH0sXG4gICAgICBpbmNsdWRlOiB7IFxuICAgICAgICBwYXJ0aWNpcGFudHM6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7IHVzZXI6IHRydWUgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNoYXQpIHJldHVybiBudWxsO1xuXG4gICAgLy8gRm9yIGRlbW8gY2hhdHMsIGlkZW50aWZ5IFVzZXIgQSBieSBkaXNwbGF5IG5hbWUsIEpvcmRhbiBieSBkaXNwbGF5IG5hbWVcbiAgICBpZiAocm9sZSA9PT0gREVNT19ST0xFUy5VU0VSX0EpIHtcbiAgICAgIGNvbnN0IHVzZXJBID0gY2hhdC5wYXJ0aWNpcGFudHMuZmluZChwID0+IHAudXNlci5kaXNwbGF5X25hbWUgPT09ICdVc2VyIEEnKTtcbiAgICAgIHJldHVybiB1c2VyQT8udXNlcl9pZCB8fCBudWxsO1xuICAgIH0gZWxzZSBpZiAocm9sZSA9PT0gREVNT19ST0xFUy5KT1JEQU4pIHtcbiAgICAgIGNvbnN0IGpvcmRhbiA9IGNoYXQucGFydGljaXBhbnRzLmZpbmQocCA9PiBwLnVzZXIuZGlzcGxheV9uYW1lID09PSAnSm9yZGFuJyk7XG4gICAgICByZXR1cm4gam9yZGFuPy51c2VyX2lkIHx8IG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBhc3luYyBnZXRSb2xlRm9yVXNlcklkKGNoYXRJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIGlmICh1c2VySWQgPT09ICdhc3Npc3RhbnQnKSB7XG4gICAgICByZXR1cm4gREVNT19ST0xFUy5NRURJQVRPUjtcbiAgICB9XG5cbiAgICBjb25zdCBjaGF0ID0gYXdhaXQgcHJpc21hLmNoYXQuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogY2hhdElkIH0sXG4gICAgICBpbmNsdWRlOiB7IFxuICAgICAgICBwYXJ0aWNpcGFudHM6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7IHVzZXI6IHRydWUgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoIWNoYXQpIHJldHVybiBudWxsO1xuXG4gICAgLy8gRm9yIGRlbW8gY2hhdHMsIGlkZW50aWZ5IFVzZXIgQSB2cyBKb3JkYW4gYnkgZGlzcGxheSBuYW1lXG4gICAgY29uc3QgcGFydGljaXBhbnQgPSBjaGF0LnBhcnRpY2lwYW50cy5maW5kKHAgPT4gcC51c2VyX2lkID09PSB1c2VySWQpO1xuICAgIGlmICghcGFydGljaXBhbnQpIHJldHVybiBudWxsO1xuXG4gICAgaWYgKHBhcnRpY2lwYW50LnVzZXIuZGlzcGxheV9uYW1lID09PSAnVXNlciBBJykge1xuICAgICAgcmV0dXJuIERFTU9fUk9MRVMuVVNFUl9BO1xuICAgIH0gZWxzZSBpZiAocGFydGljaXBhbnQudXNlci5kaXNwbGF5X25hbWUgPT09ICdKb3JkYW4nKSB7XG4gICAgICByZXR1cm4gREVNT19ST0xFUy5KT1JEQU47XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gVHVybiBzdGF0ZSBtYW5hZ2VyIC0gaGFuZGxlcyBkYXRhYmFzZSBvcGVyYXRpb25zXG5leHBvcnQgY2xhc3MgVHVyblN0YXRlTWFuYWdlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2hhdElkOiBzdHJpbmcpIHt9XG5cbiAgYXN5bmMgZ2V0Q3VycmVudFR1cm4oKTogUHJvbWlzZTxUdXJuU3RhdGUgfCBudWxsPiB7XG4gICAgY29uc3QgdHVyblN0YXRlID0gYXdhaXQgcHJpc21hLmNoYXRUdXJuU3RhdGUuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBjaGF0X2lkOiB0aGlzLmNoYXRJZCB9XG4gICAgfSk7XG5cbiAgICBpZiAoIXR1cm5TdGF0ZSkgcmV0dXJuIG51bGw7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbmV4dF9yb2xlOiAodHVyblN0YXRlIGFzIGFueSkubmV4dF9yb2xlIHx8IERFTU9fUk9MRVMuVVNFUl9BLFxuICAgICAgbmV4dF91c2VyX2lkOiB0dXJuU3RhdGUubmV4dF91c2VyX2lkIHx8IHVuZGVmaW5lZCxcbiAgICAgIHR1cm5fcXVldWU6ICgodHVyblN0YXRlIGFzIGFueSkudHVybl9xdWV1ZSBhcyBzdHJpbmdbXSkgfHwgREVGQVVMVF9UVVJOX09SREVSLFxuICAgICAgY3VycmVudF90dXJuX2luZGV4OiAodHVyblN0YXRlIGFzIGFueSkuY3VycmVudF90dXJuX2luZGV4IHx8IDBcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgdXBkYXRlVHVyblN0YXRlKHN0YXRlOiBQYXJ0aWFsPFR1cm5TdGF0ZT4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCBwcmlzbWEuY2hhdFR1cm5TdGF0ZS51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgY2hhdF9pZDogdGhpcy5jaGF0SWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgbmV4dF9yb2xlOiBzdGF0ZS5uZXh0X3JvbGUsXG4gICAgICAgIG5leHRfdXNlcl9pZDogc3RhdGUubmV4dF91c2VyX2lkLFxuICAgICAgICBjdXJyZW50X3R1cm5faW5kZXg6IHN0YXRlLmN1cnJlbnRfdHVybl9pbmRleFxuICAgICAgfSBhcyBhbnlcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGluaXRpYWxpemVUdXJuU3RhdGUoY29uZmlnOiBUdXJuQ29uZmlnLCBpbml0aWFsVXNlcklkPzogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgcHJpc21hLmNoYXRUdXJuU3RhdGUudXBzZXJ0KHtcbiAgICAgIHdoZXJlOiB7IGNoYXRfaWQ6IHRoaXMuY2hhdElkIH0sXG4gICAgICB1cGRhdGU6IHtcbiAgICAgICAgbmV4dF9yb2xlOiBjb25maWcuaW5pdGlhbFJvbGUsXG4gICAgICAgIG5leHRfdXNlcl9pZDogaW5pdGlhbFVzZXJJZCxcbiAgICAgICAgdHVybl9xdWV1ZTogY29uZmlnLnR1cm5PcmRlcixcbiAgICAgICAgY3VycmVudF90dXJuX2luZGV4OiBjb25maWcuaW5pdGlhbEluZGV4XG4gICAgICB9IGFzIGFueSxcbiAgICAgIGNyZWF0ZToge1xuICAgICAgICBjaGF0X2lkOiB0aGlzLmNoYXRJZCxcbiAgICAgICAgbmV4dF9yb2xlOiBjb25maWcuaW5pdGlhbFJvbGUsXG4gICAgICAgIG5leHRfdXNlcl9pZDogaW5pdGlhbFVzZXJJZCxcbiAgICAgICAgdHVybl9xdWV1ZTogY29uZmlnLnR1cm5PcmRlcixcbiAgICAgICAgY3VycmVudF90dXJuX2luZGV4OiBjb25maWcuaW5pdGlhbEluZGV4XG4gICAgICB9IGFzIGFueVxuICAgIH0pO1xuICB9XG59XG5cbi8vIEV2ZW50IGVtaXR0ZXIgZm9yIHJlYWwtdGltZSB1cGRhdGVzXG5leHBvcnQgY2xhc3MgVHVybkV2ZW50RW1pdHRlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2hhdElkOiBzdHJpbmcpIHt9XG5cbiAgYXN5bmMgZW1pdFR1cm5VcGRhdGUoc3RhdGU6IFR1cm5TdGF0ZSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGNoYW5uZWxOYW1lID0gZ2V0Q2hhdENoYW5uZWxOYW1lKHRoaXMuY2hhdElkKTtcbiAgICBhd2FpdCBwdXNoZXJTZXJ2ZXIudHJpZ2dlcihjaGFubmVsTmFtZSwgUFVTSEVSX0VWRU5UUy5UVVJOX1VQREFURSwgeyBcbiAgICAgIG5leHRfcm9sZTogc3RhdGUubmV4dF9yb2xlLFxuICAgICAgbmV4dF91c2VyX2lkOiBzdGF0ZS5uZXh0X3VzZXJfaWQgXG4gICAgfSk7XG4gIH1cbn1cblxuLy8gTWFpbiB0dXJuIG1hbmFnZXIgLSBvcmNoZXN0cmF0ZXMgdGhlIGNvbXBvbmVudHNcbmV4cG9ydCBjbGFzcyBUdXJuTWFuYWdlciB7XG4gIHByaXZhdGUgc3RhdGVNYW5hZ2VyOiBUdXJuU3RhdGVNYW5hZ2VyO1xuICBwcml2YXRlIGV2ZW50RW1pdHRlcjogVHVybkV2ZW50RW1pdHRlcjtcbiAgcHJpdmF0ZSByb2xlUmVzb2x2ZXI6IFJvbGVSZXNvbHZlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGNoYXRJZDogc3RyaW5nLCBcbiAgICByb2xlUmVzb2x2ZXI/OiBSb2xlUmVzb2x2ZXJcbiAgKSB7XG4gICAgdGhpcy5zdGF0ZU1hbmFnZXIgPSBuZXcgVHVyblN0YXRlTWFuYWdlcihjaGF0SWQpO1xuICAgIHRoaXMuZXZlbnRFbWl0dGVyID0gbmV3IFR1cm5FdmVudEVtaXR0ZXIoY2hhdElkKTtcbiAgICB0aGlzLnJvbGVSZXNvbHZlciA9IHJvbGVSZXNvbHZlciB8fCBuZXcgRGVtb1JvbGVSZXNvbHZlcigpO1xuICB9XG5cbiAgLy8gSW5pdGlhbGl6ZSB0dXJuIHN0YXRlIGZvciBhIGRlbW8gY2hhdFxuICBhc3luYyBpbml0aWFsaXplRGVtb1R1cm5zKHVzZXJBSWQ6IHN0cmluZywgam9yZGFuSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKCdbVHVybk1hbmFnZXJdIEluaXRpYWxpemluZyBkZW1vIHR1cm5zJywgeyBjaGF0SWQ6IHRoaXMuY2hhdElkLCB1c2VyQUlkLCBqb3JkYW5JZCB9KTtcbiAgICBcbiAgICBjb25zdCBjb25maWc6IFR1cm5Db25maWcgPSB7XG4gICAgICB0dXJuT3JkZXI6IERFRkFVTFRfVFVSTl9PUkRFUixcbiAgICAgIGluaXRpYWxSb2xlOiBERU1PX1JPTEVTLlVTRVJfQSxcbiAgICAgIGluaXRpYWxJbmRleDogMFxuICAgIH07XG5cbiAgICBhd2FpdCB0aGlzLnN0YXRlTWFuYWdlci5pbml0aWFsaXplVHVyblN0YXRlKGNvbmZpZywgdXNlckFJZCk7XG4gICAgXG4gICAgY29uc3Qgc3RhdGU6IFR1cm5TdGF0ZSA9IHtcbiAgICAgIG5leHRfcm9sZTogY29uZmlnLmluaXRpYWxSb2xlLFxuICAgICAgbmV4dF91c2VyX2lkOiB1c2VyQUlkLFxuICAgICAgdHVybl9xdWV1ZTogY29uZmlnLnR1cm5PcmRlcixcbiAgICAgIGN1cnJlbnRfdHVybl9pbmRleDogY29uZmlnLmluaXRpYWxJbmRleFxuICAgIH07XG5cbiAgICBhd2FpdCB0aGlzLmV2ZW50RW1pdHRlci5lbWl0VHVyblVwZGF0ZShzdGF0ZSk7XG4gIH1cblxuICAvLyBHZXQgY3VycmVudCB0dXJuIHN0YXRlXG4gIGFzeW5jIGdldEN1cnJlbnRUdXJuKCk6IFByb21pc2U8VHVyblN0YXRlIHwgbnVsbD4ge1xuICAgIHJldHVybiB0aGlzLnN0YXRlTWFuYWdlci5nZXRDdXJyZW50VHVybigpO1xuICB9XG5cbiAgLy8gQWR2YW5jZSB0byB0aGUgbmV4dCB0dXJuXG4gIGFzeW5jIGFkdmFuY2VUdXJuKCk6IFByb21pc2U8VHVyblN0YXRlPiB7XG4gICAgY29uc29sZS5sb2coJ1tUdXJuTWFuYWdlcl0gQWR2YW5jaW5nIHR1cm4gZm9yIGNoYXQ6JywgdGhpcy5jaGF0SWQpO1xuICAgIFxuICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFR1cm4oKTtcbiAgICBpZiAoIWN1cnJlbnRTdGF0ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB0dXJuIHN0YXRlIGZvdW5kIGZvciBjaGF0Jyk7XG4gICAgfVxuXG4gICAgY29uc3QgbmV4dEluZGV4ID0gKGN1cnJlbnRTdGF0ZS5jdXJyZW50X3R1cm5faW5kZXggKyAxKSAlIGN1cnJlbnRTdGF0ZS50dXJuX3F1ZXVlLmxlbmd0aDtcbiAgICBjb25zdCBuZXh0Um9sZSA9IGN1cnJlbnRTdGF0ZS50dXJuX3F1ZXVlW25leHRJbmRleF07XG4gICAgY29uc3QgbmV4dFVzZXJJZCA9IGF3YWl0IHRoaXMucm9sZVJlc29sdmVyLmdldFVzZXJJZEZvclJvbGUodGhpcy5jaGF0SWQsIG5leHRSb2xlKTtcblxuICAgIGNvbnNvbGUubG9nKCdbVHVybk1hbmFnZXJdIE5leHQgdHVybjonLCB7IG5leHRSb2xlLCBuZXh0VXNlcklkLCBuZXh0SW5kZXggfSk7XG5cbiAgICBjb25zdCBuZXdTdGF0ZTogVHVyblN0YXRlID0ge1xuICAgICAgbmV4dF9yb2xlOiBuZXh0Um9sZSxcbiAgICAgIG5leHRfdXNlcl9pZDogbmV4dFVzZXJJZCB8fCB1bmRlZmluZWQsXG4gICAgICB0dXJuX3F1ZXVlOiBjdXJyZW50U3RhdGUudHVybl9xdWV1ZSxcbiAgICAgIGN1cnJlbnRfdHVybl9pbmRleDogbmV4dEluZGV4XG4gICAgfTtcblxuICAgIGF3YWl0IHRoaXMuc3RhdGVNYW5hZ2VyLnVwZGF0ZVR1cm5TdGF0ZShuZXdTdGF0ZSk7XG4gICAgYXdhaXQgdGhpcy5ldmVudEVtaXR0ZXIuZW1pdFR1cm5VcGRhdGUobmV3U3RhdGUpO1xuXG4gICAgcmV0dXJuIG5ld1N0YXRlO1xuICB9XG5cbiAgLy8gU2V0IHR1cm4gdG8gYSBzcGVjaWZpYyByb2xlIChmb3IgbWVkaWF0b3IgcmVzcG9uc2VzKVxuICBhc3luYyBzZXRUdXJuVG9Sb2xlKHJvbGU6IHN0cmluZyk6IFByb21pc2U8VHVyblN0YXRlPiB7XG4gICAgY29uc29sZS5sb2coJ1tUdXJuTWFuYWdlcl0gU2V0dGluZyB0dXJuIHRvIHJvbGU6JywgeyBjaGF0SWQ6IHRoaXMuY2hhdElkLCByb2xlIH0pO1xuICAgIFxuICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFR1cm4oKTtcbiAgICBpZiAoIWN1cnJlbnRTdGF0ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB0dXJuIHN0YXRlIGZvdW5kIGZvciBjaGF0Jyk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgaW5kZXggb2YgdGhlIHJvbGUgaW4gdGhlIHF1ZXVlXG4gICAgY29uc3Qgcm9sZUluZGV4ID0gY3VycmVudFN0YXRlLnR1cm5fcXVldWUuaW5kZXhPZihyb2xlKTtcbiAgICBpZiAocm9sZUluZGV4ID09PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBSb2xlICR7cm9sZX0gbm90IGZvdW5kIGluIHR1cm4gcXVldWVgKTtcbiAgICB9XG5cbiAgICBjb25zdCB1c2VySWQgPSBhd2FpdCB0aGlzLnJvbGVSZXNvbHZlci5nZXRVc2VySWRGb3JSb2xlKHRoaXMuY2hhdElkLCByb2xlKTtcblxuICAgIGNvbnN0IG5ld1N0YXRlOiBUdXJuU3RhdGUgPSB7XG4gICAgICBuZXh0X3JvbGU6IHJvbGUsXG4gICAgICBuZXh0X3VzZXJfaWQ6IHVzZXJJZCB8fCB1bmRlZmluZWQsXG4gICAgICB0dXJuX3F1ZXVlOiBjdXJyZW50U3RhdGUudHVybl9xdWV1ZSxcbiAgICAgIGN1cnJlbnRfdHVybl9pbmRleDogcm9sZUluZGV4XG4gICAgfTtcblxuICAgIGF3YWl0IHRoaXMuc3RhdGVNYW5hZ2VyLnVwZGF0ZVR1cm5TdGF0ZShuZXdTdGF0ZSk7XG4gICAgYXdhaXQgdGhpcy5ldmVudEVtaXR0ZXIuZW1pdFR1cm5VcGRhdGUobmV3U3RhdGUpO1xuXG4gICAgcmV0dXJuIG5ld1N0YXRlO1xuICB9XG5cbiAgLy8gQ2hlY2sgaWYgYSB1c2VyIGNhbiBzZW5kIGEgbWVzc2FnZSBiYXNlZCBvbiB0aGVpciByb2xlXG4gIGFzeW5jIGNhblVzZXJTZW5kTWVzc2FnZSh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFR1cm4oKTtcbiAgICBpZiAoIWN1cnJlbnRTdGF0ZSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gQ2hlY2sgaWYgaXQncyB0aGVpciB0dXJuIGJ5IHVzZXIgSUQgKGJhY2t3YXJkIGNvbXBhdGliaWxpdHkpXG4gICAgaWYgKGN1cnJlbnRTdGF0ZS5uZXh0X3VzZXJfaWQgPT09IHVzZXJJZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgaXQncyB0aGVpciB0dXJuIGJ5IHJvbGVcbiAgICBjb25zdCB1c2VyUm9sZSA9IGF3YWl0IHRoaXMucm9sZVJlc29sdmVyLmdldFJvbGVGb3JVc2VySWQodGhpcy5jaGF0SWQsIHVzZXJJZCk7XG4gICAgcmV0dXJuIHVzZXJSb2xlID09PSBjdXJyZW50U3RhdGUubmV4dF9yb2xlO1xuICB9XG5cbiAgLy8gR2V0IHJvbGUgZm9yIGEgdXNlciBJRFxuICBhc3luYyBnZXRSb2xlRm9yVXNlcklkKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMucm9sZVJlc29sdmVyLmdldFJvbGVGb3JVc2VySWQodGhpcy5jaGF0SWQsIHVzZXJJZCk7XG4gIH1cblxuICAvLyBHZXQgdXNlciBJRCBmb3IgYSByb2xlXG4gIGFzeW5jIGdldFVzZXJJZEZvclJvbGUocm9sZTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMucm9sZVJlc29sdmVyLmdldFVzZXJJZEZvclJvbGUodGhpcy5jaGF0SWQsIHJvbGUpO1xuICB9XG59XG5cbi8vIEZhY3RvcnkgZnVuY3Rpb25zIGZvciBkaWZmZXJlbnQgY2hhdCB0eXBlc1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURlbW9UdXJuTWFuYWdlcihjaGF0SWQ6IHN0cmluZyk6IFR1cm5NYW5hZ2VyIHtcbiAgcmV0dXJuIG5ldyBUdXJuTWFuYWdlcihjaGF0SWQsIG5ldyBEZW1vUm9sZVJlc29sdmVyKCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ3VzdG9tVHVybk1hbmFnZXIoXG4gIGNoYXRJZDogc3RyaW5nLCBcbiAgcm9sZVJlc29sdmVyOiBSb2xlUmVzb2x2ZXIsXG4gIGNvbmZpZz86IFR1cm5Db25maWdcbik6IFR1cm5NYW5hZ2VyIHtcbiAgcmV0dXJuIG5ldyBUdXJuTWFuYWdlcihjaGF0SWQsIHJvbGVSZXNvbHZlcik7XG59ICJdLCJuYW1lcyI6WyJwcmlzbWEiLCJwdXNoZXJTZXJ2ZXIiLCJnZXRDaGF0Q2hhbm5lbE5hbWUiLCJQVVNIRVJfRVZFTlRTIiwiREVNT19ST0xFUyIsIlVTRVJfQSIsIkpPUkRBTiIsIk1FRElBVE9SIiwiREVGQVVMVF9UVVJOX09SREVSIiwiRGVtb1JvbGVSZXNvbHZlciIsImdldFVzZXJJZEZvclJvbGUiLCJjaGF0SWQiLCJyb2xlIiwiY2hhdCIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlkIiwiaW5jbHVkZSIsInBhcnRpY2lwYW50cyIsInVzZXIiLCJ1c2VyQSIsImZpbmQiLCJwIiwiZGlzcGxheV9uYW1lIiwidXNlcl9pZCIsImpvcmRhbiIsImdldFJvbGVGb3JVc2VySWQiLCJ1c2VySWQiLCJwYXJ0aWNpcGFudCIsIlR1cm5TdGF0ZU1hbmFnZXIiLCJjb25zdHJ1Y3RvciIsImdldEN1cnJlbnRUdXJuIiwidHVyblN0YXRlIiwiY2hhdFR1cm5TdGF0ZSIsImNoYXRfaWQiLCJuZXh0X3JvbGUiLCJuZXh0X3VzZXJfaWQiLCJ1bmRlZmluZWQiLCJ0dXJuX3F1ZXVlIiwiY3VycmVudF90dXJuX2luZGV4IiwidXBkYXRlVHVyblN0YXRlIiwic3RhdGUiLCJ1cGRhdGUiLCJkYXRhIiwiaW5pdGlhbGl6ZVR1cm5TdGF0ZSIsImNvbmZpZyIsImluaXRpYWxVc2VySWQiLCJ1cHNlcnQiLCJpbml0aWFsUm9sZSIsInR1cm5PcmRlciIsImluaXRpYWxJbmRleCIsImNyZWF0ZSIsIlR1cm5FdmVudEVtaXR0ZXIiLCJlbWl0VHVyblVwZGF0ZSIsImNoYW5uZWxOYW1lIiwidHJpZ2dlciIsIlRVUk5fVVBEQVRFIiwiVHVybk1hbmFnZXIiLCJyb2xlUmVzb2x2ZXIiLCJzdGF0ZU1hbmFnZXIiLCJldmVudEVtaXR0ZXIiLCJpbml0aWFsaXplRGVtb1R1cm5zIiwidXNlckFJZCIsImpvcmRhbklkIiwiY29uc29sZSIsImxvZyIsImFkdmFuY2VUdXJuIiwiY3VycmVudFN0YXRlIiwiRXJyb3IiLCJuZXh0SW5kZXgiLCJsZW5ndGgiLCJuZXh0Um9sZSIsIm5leHRVc2VySWQiLCJuZXdTdGF0ZSIsInNldFR1cm5Ub1JvbGUiLCJyb2xlSW5kZXgiLCJpbmRleE9mIiwiY2FuVXNlclNlbmRNZXNzYWdlIiwidXNlclJvbGUiLCJjcmVhdGVEZW1vVHVybk1hbmFnZXIiLCJjcmVhdGVDdXN0b21UdXJuTWFuYWdlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./features/chat/services/turnManager.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/.pnpm/next-auth@4.24.11_@auth+core@0.39.1_next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_r_gev7rdmj5zqi6quqd4i72ffmfu/node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _app_api_nextauth_route__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/app/api/[...nextauth]/route */ \"(rsc)/./app/api/[...nextauth]/route.ts\");\n// GPT CONTEXT:\n// This file provides a helper for retrieving the current authenticated session using NextAuth.\n// Related modules: /app/api/messages/route.ts, /lib/prisma.ts\n// Do NOT modify NextAuth config directly here.\n\n\nasync function auth() {\n    return await (0,next_auth__WEBPACK_IMPORTED_MODULE_0__.getServerSession)(_app_api_nextauth_route__WEBPACK_IMPORTED_MODULE_1__.authOptions);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsZUFBZTtBQUNmLCtGQUErRjtBQUMvRiw4REFBOEQ7QUFDOUQsK0NBQStDO0FBRUY7QUFDZTtBQUVyRCxlQUFlRTtJQUNwQixPQUFPLE1BQU1GLDJEQUFnQkEsQ0FBQ0MsZ0VBQVdBO0FBQzNDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va29tZW5zYS12NS8uL2xpYi9hdXRoLnRzP2JmN2UiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gR1BUIENPTlRFWFQ6XG4vLyBUaGlzIGZpbGUgcHJvdmlkZXMgYSBoZWxwZXIgZm9yIHJldHJpZXZpbmcgdGhlIGN1cnJlbnQgYXV0aGVudGljYXRlZCBzZXNzaW9uIHVzaW5nIE5leHRBdXRoLlxuLy8gUmVsYXRlZCBtb2R1bGVzOiAvYXBwL2FwaS9tZXNzYWdlcy9yb3V0ZS50cywgL2xpYi9wcmlzbWEudHNcbi8vIERvIE5PVCBtb2RpZnkgTmV4dEF1dGggY29uZmlnIGRpcmVjdGx5IGhlcmUuXG5cbmltcG9ydCB7IGdldFNlcnZlclNlc3Npb24gfSBmcm9tICduZXh0LWF1dGgnO1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICdAL2FwcC9hcGkvWy4uLm5leHRhdXRoXS9yb3V0ZSc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhdXRoKCkge1xuICByZXR1cm4gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucyk7XG59XG4iXSwibmFtZXMiOlsiZ2V0U2VydmVyU2Vzc2lvbiIsImF1dGhPcHRpb25zIiwiYXV0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./lib/openai.ts":
/*!***********************!*\
  !*** ./lib/openai.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   openai: () => (/* binding */ openai),\n/* harmony export */   runWithRetries: () => (/* binding */ runWithRetries)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/.pnpm/openai@4.102.0_zod@3.25.20/node_modules/openai/index.mjs\");\n\nif (!process.env.OPENAI_API_KEY) {\n    throw new Error(\"Missing OPENAI_API_KEY environment variable\");\n}\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\nasync function runWithRetries(fn, maxRetries = 3) {\n    let lastError;\n    for(let i = 0; i < maxRetries; i++){\n        try {\n            return await fn();\n        } catch (error) {\n            lastError = error;\n            if (error instanceof Error && error.message.includes(\"429\")) {\n                await new Promise((resolve)=>setTimeout(resolve, Math.pow(2, i) * 1000));\n                continue;\n            }\n            throw error;\n        }\n    }\n    throw lastError;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvb3BlbmFpLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE0QjtBQUU1QixJQUFJLENBQUNDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYyxFQUFFO0lBQy9CLE1BQU0sSUFBSUMsTUFBTTtBQUNsQjtBQUVPLE1BQU1DLFNBQVMsSUFBSUwsOENBQU1BLENBQUM7SUFDL0JNLFFBQVFMLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztBQUNwQyxHQUFHO0FBRUksZUFBZUksZUFDcEJDLEVBQW9CLEVBQ3BCQyxhQUFhLENBQUM7SUFFZCxJQUFJQztJQUNKLElBQUssSUFBSUMsSUFBSSxHQUFHQSxJQUFJRixZQUFZRSxJQUFLO1FBQ25DLElBQUk7WUFDRixPQUFPLE1BQU1IO1FBQ2YsRUFBRSxPQUFPSSxPQUFPO1lBQ2RGLFlBQVlFO1lBQ1osSUFBSUEsaUJBQWlCUixTQUFTUSxNQUFNQyxPQUFPLENBQUNDLFFBQVEsQ0FBQyxRQUFRO2dCQUMzRCxNQUFNLElBQUlDLFFBQVFDLENBQUFBLFVBQVdDLFdBQVdELFNBQVNFLEtBQUtDLEdBQUcsQ0FBQyxHQUFHUixLQUFLO2dCQUNsRTtZQUNGO1lBQ0EsTUFBTUM7UUFDUjtJQUNGO0lBQ0EsTUFBTUY7QUFDUiIsInNvdXJjZXMiOlsid2VicGFjazovL2tvbWVuc2EtdjUvLi9saWIvb3BlbmFpLnRzPzAwZDgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9wZW5BSSBmcm9tICdvcGVuYWknO1xuXG5pZiAoIXByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZKSB7XG4gIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBPUEVOQUlfQVBJX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZScpO1xufVxuXG5leHBvcnQgY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG59KTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJ1bldpdGhSZXRyaWVzPFQ+KFxuICBmbjogKCkgPT4gUHJvbWlzZTxUPixcbiAgbWF4UmV0cmllcyA9IDNcbik6IFByb21pc2U8VD4ge1xuICBsZXQgbGFzdEVycm9yOiBFcnJvcjtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhSZXRyaWVzOyBpKyspIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGZuKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxhc3RFcnJvciA9IGVycm9yIGFzIEVycm9yO1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnNDI5JykpIHtcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIE1hdGgucG93KDIsIGkpICogMTAwMCkpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICB0aHJvdyBsYXN0RXJyb3IhO1xufVxuIl0sIm5hbWVzIjpbIk9wZW5BSSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsIkVycm9yIiwib3BlbmFpIiwiYXBpS2V5IiwicnVuV2l0aFJldHJpZXMiLCJmbiIsIm1heFJldHJpZXMiLCJsYXN0RXJyb3IiLCJpIiwiZXJyb3IiLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJNYXRoIiwicG93Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/openai.ts\n");

/***/ }),

/***/ "(rsc)/./lib/prisma.ts":
/*!***********************!*\
  !*** ./lib/prisma.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n// GPT CONTEXT:\n// This file exports a Prisma client configured for use with the Neon database in a Vercel Edge-compatible way.\n// Related modules: /app/api/messages/route.ts, /prisma/schema.prisma\n// Do NOT modify this file once it is stable.\n\nconst prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcHJpc21hLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGVBQWU7QUFDZiwrR0FBK0c7QUFDL0cscUVBQXFFO0FBQ3JFLDZDQUE2QztBQUVBO0FBRXRDLE1BQU1DLFNBQVMsSUFBSUQsd0RBQVlBLEdBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9rb21lbnNhLXY1Ly4vbGliL3ByaXNtYS50cz85ODIyIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEdQVCBDT05URVhUOlxuLy8gVGhpcyBmaWxlIGV4cG9ydHMgYSBQcmlzbWEgY2xpZW50IGNvbmZpZ3VyZWQgZm9yIHVzZSB3aXRoIHRoZSBOZW9uIGRhdGFiYXNlIGluIGEgVmVyY2VsIEVkZ2UtY29tcGF0aWJsZSB3YXkuXG4vLyBSZWxhdGVkIG1vZHVsZXM6IC9hcHAvYXBpL21lc3NhZ2VzL3JvdXRlLnRzLCAvcHJpc21hL3NjaGVtYS5wcmlzbWFcbi8vIERvIE5PVCBtb2RpZnkgdGhpcyBmaWxlIG9uY2UgaXQgaXMgc3RhYmxlLlxuXG5pbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKVxuIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsInByaXNtYSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/prisma.ts\n");

/***/ }),

/***/ "(rsc)/./lib/pusher.ts":
/*!***********************!*\
  !*** ./lib/pusher.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PUSHER_EVENTS: () => (/* binding */ PUSHER_EVENTS),\n/* harmony export */   getChatChannelName: () => (/* binding */ getChatChannelName),\n/* harmony export */   pusherClient: () => (/* binding */ pusherClient),\n/* harmony export */   pusherServer: () => (/* binding */ pusherServer)\n/* harmony export */ });\n/* harmony import */ var pusher__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pusher */ \"(rsc)/./node_modules/.pnpm/pusher@5.2.0/node_modules/pusher/lib/pusher.js\");\n/* harmony import */ var pusher__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(pusher__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var pusher_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pusher-js */ \"(rsc)/./node_modules/.pnpm/pusher-js@8.4.0/node_modules/pusher-js/dist/node/pusher.js\");\n/* harmony import */ var pusher_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(pusher_js__WEBPACK_IMPORTED_MODULE_1__);\n\n\n// Server-side Pusher instance\nconst pusherServer = new (pusher__WEBPACK_IMPORTED_MODULE_0___default())({\n    appId: process.env.PUSHER_APP_ID,\n    key: process.env.PUSHER_KEY,\n    secret: process.env.PUSHER_SECRET,\n    cluster: process.env.PUSHER_CLUSTER,\n    useTLS: true\n});\n// Client-side Pusher instance\nconst pusherClient = new (pusher_js__WEBPACK_IMPORTED_MODULE_1___default())(\"4013bd94180477c7f399\", {\n    cluster: \"us3\"\n});\n// Helper function to get channel name for a chat\nconst getChatChannelName = (chatId)=>`chat-${chatId}`;\n// Event types\nconst PUSHER_EVENTS = {\n    ASSISTANT_TYPING: \"assistant-typing\",\n    ASSISTANT_TOKEN: \"assistant-token\",\n    USER_TYPING: \"user-typing\",\n    NEW_MESSAGE: \"new-message\",\n    TURN_UPDATE: \"turn-update\",\n    STATE_UPDATE: \"state-update\"\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcHVzaGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQTRCO0FBQ1M7QUFFckMsOEJBQThCO0FBQ3ZCLE1BQU1FLGVBQWUsSUFBSUYsK0NBQU1BLENBQUM7SUFDckNHLE9BQU9DLFFBQVFDLEdBQUcsQ0FBQ0MsYUFBYTtJQUNoQ0MsS0FBS0gsUUFBUUMsR0FBRyxDQUFDRyxVQUFVO0lBQzNCQyxRQUFRTCxRQUFRQyxHQUFHLENBQUNLLGFBQWE7SUFDakNDLFNBQVNQLFFBQVFDLEdBQUcsQ0FBQ08sY0FBYztJQUNuQ0MsUUFBUTtBQUNWLEdBQUc7QUFFSCw4QkFBOEI7QUFDdkIsTUFBTUMsZUFBZSxJQUFJYixrREFBWUEsQ0FBQ0csc0JBQWtDLEVBQUc7SUFDaEZPLFNBQVNQLEtBQXNDO0FBQ2pELEdBQUc7QUFFSCxpREFBaUQ7QUFDMUMsTUFBTWEscUJBQXFCLENBQUNDLFNBQW1CLENBQUMsS0FBSyxFQUFFQSxPQUFPLENBQUMsQ0FBQztBQUV2RSxjQUFjO0FBQ1AsTUFBTUMsZ0JBQWdCO0lBQzNCQyxrQkFBa0I7SUFDbEJDLGlCQUFpQjtJQUNqQkMsYUFBYTtJQUNiQyxhQUFhO0lBQ2JDLGFBQWE7SUFDYkMsY0FBYztBQUNoQixFQUFXIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8va29tZW5zYS12NS8uL2xpYi9wdXNoZXIudHM/OTAzMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUHVzaGVyIGZyb20gJ3B1c2hlcic7XG5pbXBvcnQgUHVzaGVyQ2xpZW50IGZyb20gJ3B1c2hlci1qcyc7XG5cbi8vIFNlcnZlci1zaWRlIFB1c2hlciBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHB1c2hlclNlcnZlciA9IG5ldyBQdXNoZXIoe1xuICBhcHBJZDogcHJvY2Vzcy5lbnYuUFVTSEVSX0FQUF9JRCEsXG4gIGtleTogcHJvY2Vzcy5lbnYuUFVTSEVSX0tFWSEsXG4gIHNlY3JldDogcHJvY2Vzcy5lbnYuUFVTSEVSX1NFQ1JFVCEsXG4gIGNsdXN0ZXI6IHByb2Nlc3MuZW52LlBVU0hFUl9DTFVTVEVSISxcbiAgdXNlVExTOiB0cnVlLFxufSk7XG5cbi8vIENsaWVudC1zaWRlIFB1c2hlciBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHB1c2hlckNsaWVudCA9IG5ldyBQdXNoZXJDbGllbnQocHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfUFVTSEVSX0tFWSEsIHtcbiAgY2x1c3RlcjogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfUFVTSEVSX0NMVVNURVIhLFxufSk7XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgY2hhbm5lbCBuYW1lIGZvciBhIGNoYXRcbmV4cG9ydCBjb25zdCBnZXRDaGF0Q2hhbm5lbE5hbWUgPSAoY2hhdElkOiBzdHJpbmcpID0+IGBjaGF0LSR7Y2hhdElkfWA7XG5cbi8vIEV2ZW50IHR5cGVzXG5leHBvcnQgY29uc3QgUFVTSEVSX0VWRU5UUyA9IHtcbiAgQVNTSVNUQU5UX1RZUElORzogJ2Fzc2lzdGFudC10eXBpbmcnLFxuICBBU1NJU1RBTlRfVE9LRU46ICdhc3Npc3RhbnQtdG9rZW4nLCBcbiAgVVNFUl9UWVBJTkc6ICd1c2VyLXR5cGluZycsXG4gIE5FV19NRVNTQUdFOiAnbmV3LW1lc3NhZ2UnLFxuICBUVVJOX1VQREFURTogJ3R1cm4tdXBkYXRlJyxcbiAgU1RBVEVfVVBEQVRFOiAnc3RhdGUtdXBkYXRlJyxcbn0gYXMgY29uc3Q7ICJdLCJuYW1lcyI6WyJQdXNoZXIiLCJQdXNoZXJDbGllbnQiLCJwdXNoZXJTZXJ2ZXIiLCJhcHBJZCIsInByb2Nlc3MiLCJlbnYiLCJQVVNIRVJfQVBQX0lEIiwia2V5IiwiUFVTSEVSX0tFWSIsInNlY3JldCIsIlBVU0hFUl9TRUNSRVQiLCJjbHVzdGVyIiwiUFVTSEVSX0NMVVNURVIiLCJ1c2VUTFMiLCJwdXNoZXJDbGllbnQiLCJORVhUX1BVQkxJQ19QVVNIRVJfS0VZIiwiTkVYVF9QVUJMSUNfUFVTSEVSX0NMVVNURVIiLCJnZXRDaGF0Q2hhbm5lbE5hbWUiLCJjaGF0SWQiLCJQVVNIRVJfRVZFTlRTIiwiQVNTSVNUQU5UX1RZUElORyIsIkFTU0lTVEFOVF9UT0tFTiIsIlVTRVJfVFlQSU5HIiwiTkVXX01FU1NBR0UiLCJUVVJOX1VQREFURSIsIlNUQVRFX1VQREFURSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/pusher.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_react-dom@18.2.0_react@18.2.0__react@18.2.0","vendor-chunks/next-auth@4.24.11_@auth+core@0.39.1_next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_r_gev7rdmj5zqi6quqd4i72ffmfu","vendor-chunks/@opentelemetry+api@1.9.0","vendor-chunks/@babel+runtime@7.27.1","vendor-chunks/pusher-js@8.4.0","vendor-chunks/tr46@0.0.3","vendor-chunks/jose@4.15.9","vendor-chunks/tweetnacl@1.0.3","vendor-chunks/openid-client@5.7.1","vendor-chunks/node-fetch@2.7.0","vendor-chunks/whatwg-url@5.0.0","vendor-chunks/pusher@5.2.0","vendor-chunks/event-target-shim@5.0.1","vendor-chunks/oauth@0.9.15","vendor-chunks/object-hash@2.2.0","vendor-chunks/preact@10.24.3","vendor-chunks/webidl-conversions@3.0.1","vendor-chunks/uuid@8.3.2","vendor-chunks/yallist@4.0.0","vendor-chunks/preact-render-to-string@5.2.6_preact@10.24.3","vendor-chunks/lru-cache@6.0.0","vendor-chunks/cookie@0.7.2","vendor-chunks/abort-controller@3.0.0","vendor-chunks/tweetnacl-util@0.15.1","vendor-chunks/oidc-token-hash@5.1.0","vendor-chunks/@panva+hkdf@1.2.1","vendor-chunks/is-base64@1.1.0","vendor-chunks/formdata-node@4.4.1","vendor-chunks/@auth+prisma-adapter@2.9.1_@prisma+client@6.8.2_prisma@6.8.2_typescript@5.8.3__typescript@5.8.3_","vendor-chunks/openai@4.102.0_zod@3.25.20","vendor-chunks/form-data-encoder@1.7.2","vendor-chunks/agentkeepalive@4.6.0","vendor-chunks/web-streams-polyfill@4.0.0-beta.3","vendor-chunks/ms@2.1.3","vendor-chunks/humanize-ms@1.2.1"], () => (__webpack_exec__("(rsc)/./node_modules/.pnpm/next@14.2.3_@babel+core@7.27.1_@opentelemetry+api@1.9.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmessages%2Froute&page=%2Fapi%2Fmessages%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmessages%2Froute.ts&appDir=%2FUsers%2Fmichael%2FDocuments%2FKomensa-5%2Fkomensa%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmichael%2FDocuments%2FKomensa-5%2Fkomensa&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();